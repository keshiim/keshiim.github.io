<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Farmer, keshiim 播种太阳🌞" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="一个☝程序猿的播种天地">
<meta property="og:type" content="website">
<meta property="og:title" content="Farmer, keshiim 播种太阳🌞">
<meta property="og:url" content="https://keshiim.github.io/page/2/index.html">
<meta property="og:site_name" content="Farmer, keshiim 播种太阳🌞">
<meta property="og:description" content="一个☝程序猿的播种天地">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Farmer, keshiim 播种太阳🌞">
<meta name="twitter:description" content="一个☝程序猿的播种天地">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://keshiim.github.io/page/2/"/>





  <title>Farmer, keshiim 播种太阳🌞</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?921c9b00f7bef5665a875398ea470185";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Farmer, keshiim 播种太阳🌞</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">小n快乐成长🍉</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://keshiim.github.io/2017/11/28/Swift-initialization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng keshiim">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Farmer, keshiim 播种太阳🌞">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/28/Swift-initialization/" itemprop="url">Swift：初始化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-28T16:44:45+08:00">
                2017-11-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/28/Swift-initialization/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/28/Swift-initialization/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/11/28/Swift-initialization/" class="leancloud_visitors" data-flag-title="Swift：初始化">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><em>初始化</em>是为类、结构体或者枚举准备实例的过程。这个过需要给实例里的每一个存储属性设置一个初始值并且在新实例可以使用之前执行任何其他所必须的配置或初始化。</p>
<p>你通过定义<strong>初始化器</strong>来实现这个初始化过程，它更像是一个用来创建特定类型新实例的特殊的方法。<strong>不同于 Objective-C 的初始化器，Swift 初始化器不返回值</strong>。这些初始化器主要的角色就是确保在第一次使用之前某类型的新实例能够正确初始化。</p>
<p><em>类</em> 类型的实例同样可以实现一个<strong>反初始化器</strong>，它会在这个类的实例被释放之前执行任意的自定义清理。</p>
<h3 id="为存储属性设置初始化值"><a href="#为存储属性设置初始化值" class="headerlink" title="为存储属性设置初始化值"></a>为存储属性设置初始化值</h3><p>在创建类和结构体的实例时<strong>必须</strong>为所有的存储属性设置一个合适的初始值。<em>存储属性不能遗留在不确定的状态中。</em></p>
<p>你可以在初始化器里为存储属性设置一个初始值，或者通过分配一个默认的属性值作为属性定义的一部分。在下面的小节中会描述这些动作。</p>
<blockquote>
<p>注意<br>当你给一个存储属性分配默认值，或者在一个初始化器里设置它的初始值的时候，属性的值就会被直接设置，不会调用任何属性监听器。</p>
</blockquote>
<h4 id="初始化器"><a href="#初始化器" class="headerlink" title="初始化器"></a>初始化器</h4><p><em>初始化器</em>在创建特定类型的实例时被调用。在这个简单的形式中，初始化器就像一个没有形式参数的实例方法，使用 <code>init</code> 关键字来写：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">init</span>() &#123;</div><div class="line">    <span class="comment">// perform some initialization here</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>下面的栗子定义了一个名为 <code>Fahrenheit</code> 结构体以储存华氏度表示的温度。 <code>Fahrenheit</code> 结构体有一个 <code>Double</code> 类型的存储属性 <code>temperature</code> ：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Fahrenheit</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> temperature: <span class="type">Double</span></div><div class="line">    <span class="keyword">init</span>() &#123;</div><div class="line">        temperature = <span class="number">32.0</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> f = <span class="type">Fahrenheit</span>()</div><div class="line"><span class="built_in">print</span>(<span class="string">"The default temperature is <span class="subst">\(f.temperature)</span>° Fahrenheit"</span>)</div><div class="line"><span class="comment">// prints "The default temperature is 32.0° Fahrenheit"</span></div></pre></td></tr></table></figure>
<p>这个结构体定义了一个初始化器， <code>init</code> ，没有形式参数，它初始化储存温度的值为 32.0 (在华氏温度下水的冰点)。</p>
<h4 id="默认的属性值"><a href="#默认的属性值" class="headerlink" title="默认的属性值"></a>默认的属性值</h4><p>如上所述，你可以在初始化器里为存储属性设置初始值。另外，<em>指定一个默认属性值作为属性声明的一部分</em>。当属性被定义的时候你可以通过为这个属性分配一个初始值来指定默认的属性值。</p>
<blockquote>
<p>注意<br>如果一个属性一直保持相同的初始值，可以提供一个默认值而不是在初始化器里设置这个值。最终结果是一样的，但是默认值将属性的初始化与声明更紧密地联系到一起。它使得你的初始化器更短更清晰，并且可以让你属性根据默认值推断类型。如后边的章节所述，<strong>默认值也让你使用默认初始化器和初始化器继承更加容易</strong>。</p>
</blockquote>
<p>通过提供 <code>temperature</code> 属性的默认值，你可以把上面的 <code>Fahrenheit</code> 结构体写的更简单：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Fahrenheit</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> temperature = <span class="number">32.0</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="自定义初始化"><a href="#自定义初始化" class="headerlink" title="自定义初始化"></a>自定义初始化</h3><p>如同下面章节所述，你可以通过<em>输入形式参数</em>和<em>可选类型</em>来自定义初始化过程，或者在初始化的时候分配常量属性。</p>
<h4 id="初始化形式参数"><a href="#初始化形式参数" class="headerlink" title="初始化形式参数"></a>初始化形式参数</h4><p>你可以<strong>提供初始化形式参数作为初始化器</strong>的一部分，来定义初始化过程中的类型和值的名称。初始化形式参数与函数和方法的形式参数具有相同的功能和语法。</p>
<p>下面的栗子定义了一个名为 <code>Celsius</code> 的结构体，它用摄氏度表示储存温度。 <code>Celsius</code> 结构体实现了两个自定义的初始化器 <code>init(fromFahrenheit:)</code> 和 <code>init(fromKelvin:)</code> ， 它们用不同的温度单位初始化新的结构体实例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Celsius</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> temperatureInCelsius: <span class="type">Double</span></div><div class="line">    <span class="keyword">init</span>(fromFahrenheit fahrenheit: <span class="type">Double</span>) &#123;</div><div class="line">        temperatureInCelsius = (fahrenheit - <span class="number">32.0</span>) / <span class="number">1.8</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">init</span>(fromKelvin kelvin: <span class="type">Double</span>) &#123;</div><div class="line">        temperatureInCelsius = kelvin - <span class="number">273.15</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">let</span> boilingPointOfWater = <span class="type">Celsius</span>(fromFahrenheit: <span class="number">212.0</span>)</div><div class="line"><span class="comment">// boilingPointOfWater.temperatureInCelsius is 100.0</span></div><div class="line"><span class="keyword">let</span> freezingPointOfWater = <span class="type">Celsius</span>(fromKelvin: <span class="number">273.15</span>)</div><div class="line"><span class="comment">// freezingPointOfWater.temperatureInCelsius is 0.0</span></div></pre></td></tr></table></figure>
<p>第一个初始化器只有一个外部变量名 <code>fromFahrenheit</code> 和一个局部变量名 <code>fahrenheit</code> 的初始化形式参数。第二个初始化器只有一个外部变量名 <code>fromKelvin</code> 和一个局部变量名 <code>kelvin</code> 的初始化形式参数。这两个初始化器都把它们的实际参数转换为了摄氏度并且把这个值储存到了名为 <code>temperatureInCelsius</code> 的属性里。</p>
<h4 id="形式参数名和实际参数标签"><a href="#形式参数名和实际参数标签" class="headerlink" title="形式参数名和实际参数标签"></a>形式参数名和实际参数标签</h4><p>与函数和方法的形式参数一样，初始化形式参数也可以在初始化器内部有一个局部变量名以及实际参数标签供调用的时候使用。</p>
<p>总之，初始化器并不能像函数和方法那样在圆括号前面有一个用来区分的函数名。因此，一个初始化器的参数名称和类型在识别该调用哪个初始化器的时候就扮演了一个非常重要的角色。因此，<strong>如果你没有提供外部名 Swift 会自动为每一个形式参数提供一个外部名称</strong>。</p>
<p>下面的栗子定义了一个名为 <code>Color</code> 的结构体，它有三个常量属性，分别为 <code>red</code> ， <code>green</code> 和 <code>blue</code> 。这些属性储存了一个介于 0.0 到 1.0 之间的值来表示颜色里的红、绿、蓝。</p>
<p><code>Color</code> 给它的红绿蓝组合提供了一个初始化器，它带有三个合适名称的 <code>Double</code> 类型形式参数。 <code>Color</code> 同样提供了第二个只有一个 <code>white</code> 形式参数的初始化器，它用来给三个颜色组合设置相同的值：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Color</span> </span>&#123;</div><div class="line">    <span class="keyword">let</span> red, green, blue: <span class="type">Double</span></div><div class="line">    <span class="keyword">init</span>(red: <span class="type">Double</span>, green: <span class="type">Double</span>, blue: <span class="type">Double</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.red   = red</div><div class="line">        <span class="keyword">self</span>.green = green</div><div class="line">        <span class="keyword">self</span>.blue  = blue</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">init</span>(white: <span class="type">Double</span>) &#123;</div><div class="line">        red   = white</div><div class="line">        green = white</div><div class="line">        blue  = white</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过为每一个初始化器的形式参数提供一个初始值，初始化器可以用来创建新的 <code>Color</code> 实例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> magenta = <span class="type">Color</span>(red: <span class="number">1.0</span>, green: <span class="number">0.0</span>, blue: <span class="number">1.0</span>)</div><div class="line"><span class="keyword">let</span> halfGray = <span class="type">Color</span>(white: <span class="number">0.5</span>)</div></pre></td></tr></table></figure>
<p><strong>注意不使用外部名称是不能调用这些初始化器的</strong>。如果定义了外部参数名就必须用在初始化器里，省略的话会报一个编译时错误：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> veryGreen = <span class="type">Color</span>(<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>) <span class="comment">//编译报错</span></div><div class="line"><span class="comment">// this reports a compile-time error - external names are required</span></div></pre></td></tr></table></figure>
<h4 id="无实际参数标签的初始化器形式参数"><a href="#无实际参数标签的初始化器形式参数" class="headerlink" title="无实际参数标签的初始化器形式参数"></a>无实际参数标签的初始化器形式参数</h4><p>如果你不想为初始化器形式参数使用实际参数标签，可以写一个下划线( <code>_</code> )替代明确的实际参数标签以重写默认行为。</p>
<p>这里有一个之前 <code>Celsius</code> 类的扩展版本栗子，它有一个额外的初始化器来从已经是摄氏度的 <code>Double</code> 值创建一个新的 <code>Celsius</code> 类实例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Celsius</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> temperatureInCelsius: <span class="type">Double</span></div><div class="line">    <span class="keyword">init</span>(fromFahrenheit fahrenheit: <span class="type">Double</span>) &#123;</div><div class="line">        temperatureInCelsius = (fahrenheit - <span class="number">32.0</span>) / <span class="number">1.8</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">init</span>(fromKelvin kelvin: <span class="type">Double</span>) &#123;</div><div class="line">        temperatureInCelsius = kelvin - <span class="number">273.15</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">init</span>(<span class="number">_</span> celsius: <span class="type">Double</span>) &#123;</div><div class="line">        temperatureInCelsius = celsius</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">let</span> bodyTemperature = <span class="type">Celsius</span>(<span class="number">37.0</span>)</div></pre></td></tr></table></figure>
<p>调用初始化器<code>Celsius(37.0)</code> 有着清楚的意图而<em>不需要外部形式参数名</em>。因此，把初始化器写为 <code>init(_ celsius: Double)</code> 是合适的，它也就可以通过提供未命名的 <code>Double</code> 值被调用了。</p>
<h4 id="可选属性类型"><a href="#可选属性类型" class="headerlink" title="可选属性类型"></a>可选属性类型</h4><p>如果你的自定义类型有一个逻辑上是允许“无值”的存储属性——大概因为它的值在初始化期间不能被设置，或者因为它在稍后允许设置为“无值”——声明属性为<strong>可选类型</strong>。可选类型的属性自动地初始化为 <code>nil</code> ，表示该属性在初始化期间故意设为“还没有值”。</p>
<p>下面的栗子定义了一个名为 <code>SurveyQuestion</code> 的类，有一个可选 <code>String</code> 属性，名为 <code>response</code> ：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SurveyQuestion</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> text: <span class="type">String</span></div><div class="line">    <span class="keyword">var</span> response: <span class="type">String</span>?</div><div class="line">    <span class="keyword">init</span>(text: <span class="type">String</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.text = text</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">ask</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="built_in">print</span>(text)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">let</span> cheeseQuestion = <span class="type">SurveyQuestion</span>(text: <span class="string">"Do you like cheese?"</span>)</div><div class="line">cheeseQuestion.ask()</div><div class="line"><span class="comment">// prints "Do you like cheese?"</span></div><div class="line">cheeseQuestion.response = <span class="string">"Yes, I do like cheese."</span></div></pre></td></tr></table></figure>
<p>对调查问题的回答直到被问的时候才能知道，所以 <code>response</code> 属性被声明为 <code>String?</code> 类型，或者是“可选 Stirng ”。当新的 <code>SurveyQuestion</code> 实例被初始化的时候，它会自动分配一个为 <code>nil</code> 的默认值，<strong>意味着“还没有字符串”</strong>。</p>
<h4 id="在初始化中分配常量属性"><a href="#在初始化中分配常量属性" class="headerlink" title="在初始化中分配常量属性"></a>在初始化中分配常量属性</h4><p><strong>在初始化的任意时刻，你都可以给常量属性赋值</strong>，只要它在初始化结束是设置了确定的值即可。一旦为常量属性被赋值，它就不能再被修改了。</p>
<blockquote>
<p>对于类实例来说，常量属性在初始化中只能通过引用的类来修改。它不能被子类修改。</p>
</blockquote>
<p>你可以修改上面 <code>SurveyQuestion</code> 的例子，给 <code>text</code> 使用常量属性而不是变量属性来表示问题，来明确一旦 <code>SurveyQuestion</code> 的实例被创建，那个问题将不会改变。尽管现在 <code>text</code> 属性是一个常量，但是它依然可以在类的初始化器里设置：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SurveyQuestion</span> </span>&#123;</div><div class="line">    <span class="keyword">let</span> text: <span class="type">String</span></div><div class="line">    <span class="keyword">var</span> response: <span class="type">String</span>?</div><div class="line">    <span class="keyword">init</span>(text: <span class="type">String</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.text = text</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">ask</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="built_in">print</span>(text)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">let</span> beetsQuestion = <span class="type">SurveyQuestion</span>(text: <span class="string">"How about beets?"</span>)</div><div class="line">beetsQuestion.ask()</div><div class="line"><span class="comment">// prints "How about beets?"</span></div><div class="line">beetsQuestion.response = <span class="string">"I also like beets. (But not with cheese.)"</span></div></pre></td></tr></table></figure>
<h3 id="默认初始化器"><a href="#默认初始化器" class="headerlink" title="默认初始化器"></a>默认初始化器</h3><p>Swift 为所有没有提供初始化器的<em>结构体</em>或<em>类</em>提供了一个<strong>默认的初始化器</strong>来给所有的属性提供了<em>默认值</em>。这个默认的初始化器只是简单地创建了一个所有属性都有默认值的新实例。</p>
<p>这个栗子定义了一个名为 <code>ShoppingListItem</code> 的类，它在购物列表的物品里封装了名称，数量和购买状态属性：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShoppingListItem</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> name: <span class="type">String</span>?</div><div class="line">    <span class="keyword">var</span> quantity = <span class="number">1</span></div><div class="line">    <span class="keyword">var</span> purchased = <span class="literal">false</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> item = <span class="type">ShoppingListItem</span>()</div><div class="line"><span class="built_in">print</span>(item.name + <span class="string">" "</span> + item.quantity + <span class="string">" "</span> + item.purchased)</div></pre></td></tr></table></figure>
<p>由于 <code>ShoppingListItem</code> 类的<strong>所有属性都有默认值</strong>，又由于它是一个没有父类的基类， <code>ShoppingListItem</code> 类自动地获得了一个默认的初始化器，使用默认值设置了它的所有属性然后创建了新的实例。( <code>name</code> 属性是一个可选 <code>String</code> 属性，所以它会自动设置为 <code>nil</code> 默认值，尽管这个值没有写在代码里。)上面的栗子给 <code>ShoppingListItem</code> 类使用默认初始化器以及初始化器语法创建新的实例，写作 <code>ShoppingListItem()</code> ，并且给这个新实例赋了一个名为 <code>item</code> 的变量。</p>
<h4 id="结构体类型的成员初始化器"><a href="#结构体类型的成员初始化器" class="headerlink" title="结构体类型的成员初始化器"></a>结构体类型的成员初始化器</h4><p>如果结构体类型中<strong>没有定义任何自定义初始化器</strong>，<strong>它会自动获得一个成员初始化器</strong>。不同于默认初始化器，结构体会接收成员初始化器<em>即使它的存储属性没有默认值</em>。</p>
<p>这个成员初始化器是一个快速初始化新结构体实例成员属性的方式。新实例的属性初始值可以通过名称传递到成员初始化器里。</p>
<p>下面的栗子定义了一个名为 <code>Size</code> 有两个属性分别是 <code>width</code> 和 <code>height</code> 的结构体，这两个属性通过分配默认值 <code>0.0</code> ，从而被推断为 <code>Double</code> 类型。</p>
<p><code>Size</code> 结构体自动接收一个 <code>init(width:heght:)</code> 成员初始化器，你可以使用它来初始化一个新的 <code>Size</code> 实例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Size</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> width = <span class="number">0.0</span>, height = <span class="number">0.0</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">let</span> twoByTwo = <span class="type">Size</span>(width: <span class="number">2.0</span>, height: <span class="number">2.0</span>)</div></pre></td></tr></table></figure>
<h3 id="值类型的初始化器委托"><a href="#值类型的初始化器委托" class="headerlink" title="值类型的初始化器委托"></a>值类型的初始化器委托</h3><p><strong>初始化器可以调用其他初始化器来执行部分实例的初始化</strong>。这个过程，<strong>就是所谓的初始化器委托</strong>，避免了多个初始化器里冗余代码。</p>
<p>初始化器委托的运作，以及允许那些形式的委托，这些规则对于<em>值类型和类类型</em>是<strong>不同的</strong>。值类型(结构体和枚举)不支持继承，所以他它们的初始化器委托的过程相当简单，因为它们只能提供它们自己为另一个初始化器委托。如同继承里描述的那样，总之，类可以从其他类继承。这就意味着类有额外的责任来确保它们继承的所有存储属性在初始化期间都分配了一个合适的值。</p>
<p><strong>对于值类型</strong>，当你写自己自定义的初始化器时可以使用 <code>self.init</code> 从相同的值类型里引用其他初始化器。你只能从初始化器里调用 <code>self.init</code> 。</p>
<blockquote>
<p>注意如果你为值类型定义了自定义初始化器，<strong>你就不能访问那个类型的默认初始化器</strong>(或者是成员初始化器，如果是结构体的话)。这个限制防止别人意外地使用自动初始化器而把复杂初始化器里提供的额外必要配置给覆盖掉的情况发生。</p>
<ul>
<li>如果你想要你自己的自定义值类型能够使用默认初始化器和成员初始化器初始化，以及你的自定义初始化器来初始化，把你的自定义初始化器写在扩展里而不是作为值类型原始实的一部分。</li>
</ul>
</blockquote>
<p>下面的栗子定义了一个自定义的 <code>Rect</code> 结构体代表几何矩形。这个栗子需要两个结构体，分别是 <code>Size</code> 和 <code>Point</code> ，都为他们各自的属性默认值都是 <code>0.0</code> ：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Size</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> width = <span class="number">0.0</span>, height = <span class="number">0.0</span></div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>你可以用三个方式中的任意一个来初始化下面的 <code>Rect</code> 结构体——通过使用默认赋零初始化 <code>origin</code> 和 <code>size</code> 属性值，通过提供一个具体的原点坐标和大小，或者提供一个具体的中心点和大小。这三种初始化选项通过三个写在 <code>Rect</code> 结构体定义里的自定义初始化器代表：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Rect</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> origin = <span class="type">Point</span>()</div><div class="line">    <span class="keyword">var</span> size = <span class="type">Size</span>()</div><div class="line">    <span class="keyword">init</span>() &#123;&#125;</div><div class="line">    <span class="keyword">init</span>(origin: <span class="type">Point</span>, size: <span class="type">Size</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.origin = origin</div><div class="line">        <span class="keyword">self</span>.size = size</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">init</span>(center: <span class="type">Point</span>, size: <span class="type">Size</span>) &#123;</div><div class="line">        <span class="keyword">let</span> originX = center.x - (size.width / <span class="number">2</span>)</div><div class="line">        <span class="keyword">let</span> originY = center.y - (size.height / <span class="number">2</span>)</div><div class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(origin: <span class="type">Point</span>(x: originX, y: originY), size: size)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>第一个 <code>Rect</code> 初始化器， <code>init()</code> ，和默认初始化器有一样的功能，就是那个如果 <code>Rect</code> 没有自定义初始化器，它将会使用的那个默认初始化器。这个初始化器是空的，用一个大括号 <code>{}</code> 来表示，并且不会执行任何初始化。调用这个初始化器会返回一个 <code>origin</code> 和 <code>size</code> 属性都被初始化为默认值 <code>0.0</code> 的 <code>Rect</code> 实例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> basicRect = <span class="type">Rect</span>()</div><div class="line"><span class="comment">// basicRect's origin is (0.0, 0.0) and its size is (0.0, 0.0)</span></div></pre></td></tr></table></figure>
<p>第二个 <code>Rect</code> 初始化器， <code>init(origin:size)</code> ，和成员初始化器功能相同，就是如果 <code>Rect</code> 没有自定义的初始化器，它将使用的那个初始化器。这个初始化器只是把 origin 和 size 实际参数值赋值给合适的存储属性。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> originRect = <span class="type">Rect</span>(origin: <span class="type">Point</span>(x: <span class="number">2.0</span>, y: <span class="number">2.0</span>),</div><div class="line">    size: <span class="type">Size</span>(width: <span class="number">5.0</span>, height: <span class="number">5.0</span>))</div><div class="line"><span class="comment">// originRect's origin is (2.0, 2.0) and its size is (5.0, 5.0)</span></div></pre></td></tr></table></figure>
<p>第三个 <code>Rect</code> 的初始化器， <code>init(center:size:)</code>，略显复杂。它以计算一个基于 center 和 size 值的原点开始。然后调用(<em>或是委托</em>) <code>init(origin:size:)</code> 初始化器，它在合适的属性里储存了新的原点和大小值：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> centerRect = <span class="type">Rect</span>(center: <span class="type">Point</span>(x: <span class="number">4.0</span>, y: <span class="number">4.0</span>),</div><div class="line">    size: <span class="type">Size</span>(width: <span class="number">3.0</span>, height: <span class="number">3.0</span>))</div><div class="line"><span class="comment">// centerRect's origin is (2.5, 2.5) and its size is (3.0, 3.0)</span></div></pre></td></tr></table></figure>
<p><code>init(center:size:)</code> 初始化器可能自己已经为 <code>origin</code> 和 <code>size</code> 属性赋值了新值。总之，对于 <code>init(center:size:)</code> 初始化器来说，可以更方便(更清楚)地利用现有已经提供了准确功能的初始化器。</p>
<h3 id="类的继承和初始化"><a href="#类的继承和初始化" class="headerlink" title="类的继承和初始化"></a>类的继承和初始化</h3><p>所有类的存储属性——包括从它的父类继承的所有属性——<strong>都必须在初始化期间分配初始值</strong>。</p>
<p>Swift 为类类型定义了两种初始化器以确保所有的存储属性接收一个初始值。<strong>这些就是所谓的指定初始化器和便捷初始化器</strong>。</p>
<h4 id="指定初始化器和便捷初始化器"><a href="#指定初始化器和便捷初始化器" class="headerlink" title="指定初始化器和便捷初始化器"></a>指定初始化器和便捷初始化器</h4><p><em>指定初始化器</em>是类的<strong>主要初始化器</strong>。指定的初始化器可以初始化所有那个类引用的属性并且调用合适的父类初始化器来继续这个初始化过程给父类链。</p>
<p><strong>类偏向于少量指定初始化器，并且一个类通常只有一个指定初始化器。指定初始化器是初始化开始并持续初始化过程到父类链的“传送”点</strong>。</p>
<p>每个类至少得有一个指定初始化器。如同在自动初始化器的继承里描述的那样，在某些情况下，这些需求通过从父类继承一个或多个指定初始化器来满足。</p>
<p><strong>便捷初始化器</strong>是次要的，为一个类支持初始化器。你可以在相同的类里定义一个<strong>便捷初始化器来调用一个指定的初始化器作为便捷初始化器来给指定初始化器</strong>设置默认形式参数。你也可以为具体的使用情况或输入的值类型定义一个便捷初始化器从而创建这个类的实例。<br>如果你的类不需要便捷初始化器你可以不提供它。在为通用的初始化模式创建快捷方式以节省时间或者类的初始化更加清晰明了的时候时候便捷初始化器。</p>
<h4 id="指定初始化器和便捷初始化器语法"><a href="#指定初始化器和便捷初始化器语法" class="headerlink" title="指定初始化器和便捷初始化器语法"></a>指定初始化器和便捷初始化器语法</h4><p>用与值类型的简单初始化器相同的方式来写类的指定初始化器：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">init</span>(parameters) &#123;</div><div class="line">    statements</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>便捷初始化器有着相同的书写方式，但是要用 <code>convenience</code> 修饰符放到 <code>init</code> 关键字前，用空格隔开：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">convenience</span> <span class="keyword">init</span>(parameters) &#123;</div><div class="line">    statements</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="类类型的初始化器委托"><a href="#类类型的初始化器委托" class="headerlink" title="类类型的初始化器委托"></a>类类型的初始化器委托</h4><p>为了<em>简化指定和便捷初始化器之间的调用关系</em>，Swift 在初始化器之间的委托调用有下面的三个规则:</p>
<h5 id="规则1"><a href="#规则1" class="headerlink" title="规则1"></a>规则1</h5><p>指定初始化器必须从它的直系父类调用指定初始化器。</p>
<h5 id="规则-2"><a href="#规则-2" class="headerlink" title="规则 2"></a>规则 2</h5><p>便捷初始化器必须从相同的类里调用另一个初始化器。</p>
<h5 id="规则-3"><a href="#规则-3" class="headerlink" title="规则 3"></a>规则 3</h5><p>便捷初始化器最终必须调用一个指定初始化器。</p>
<p>简单记忆的这些规则的方法如下：</p>
<ul>
<li>指定初始化器必须总是向上委托。</li>
<li>便捷初始化器必须总是横向委托。</li>
</ul>
<p>下图中表示了这些规则：<br><img style="margin: auto" src="/2017/11/28/Swift-initialization/initializerDelegation01_2x.png" ,="" alt="initializerDelegation01_2x.png" title="初始化器规则表"><br>如图所示，父类包含一个指定初始化器和两个便捷初始化器。一个便捷初始化器调用另一个便捷初始化器，而后者又调用了指定初始化器。这满足了上边的规则2和规则3。父类本身没有其他父类，所以规则1不适用。</p>
<p>这个图中的子类有两个指定初始化器和一个便捷初始化器。便捷初始化器必须调用这两个指定初始化器之一，因为它只能中同一个类中调用初始化器。这满足了上边的规则2和规则3。两个指定初始化器又必须从父类调用一个指定初始化器，这满足了上边所说的规则1。</p>
<blockquote>
<p>这些规则不会影响你的类的使用者为每个类创建实例。任何上图的初始化器都可以用来完整创建对应类的实例。这个规则只在类的实现时有影响。</p>
</blockquote>
<p>下图展示了四个类之间更复杂的层级结构。它演示了指定初始化器是如何在此层级结构中充当<strong>”管道”</strong>作用，在类的初始化链上简化了类之间的内部关系：<br><img style="margin: auto" src="/2017/11/28/Swift-initialization/initializerDelegation02_2x.png" ,="" alt="initializerDelegation02_2x" title="多继承管道内部关系"></p>
<h4 id="两段式初始化"><a href="#两段式初始化" class="headerlink" title="两段式初始化"></a>两段式初始化</h4><p>Swift 的类初始化是一个两段式过程。在第一个阶段，每一个存储属性被引入类为分配了一个初始值。一旦每个存储属性的初始状态被确定，第二个阶段就开始了，每个类都有机会在新的实例准备使用之前来定制它的存储属性。<br>两段式初始化过程的使用让初始化更加安全，同时在每个类的层级结构给与了完备的灵活性。两段式初始化过程可以防止属性值在初始化之前被访问，还可以防止属性值被另一个初始化器意外地赋予不同的值。</p>
<blockquote>
<p>Swift 的两段式初始化过程与 Objective-C 的初始化类似。主要的不同点是在第一阶段，Objective-C 为每一个属性分配零或空值(例如 0 或 nil )。Swift 的初始化流程更加灵活，它允许你设置自定义的初始值，并可以自如应对 0 或 nil 不为合法值的情况。</p>
</blockquote>
<p>Swift编译器执行四种有效的安全检查来确保两段式初始化过程能够顺利完成：</p>
<h5 id="安全检查-1"><a href="#安全检查-1" class="headerlink" title="安全检查 1"></a>安全检查 1</h5><p><strong>指定初始化器必须保证在向上委托给父类初始化器之前，其所在类引入的所有属性都要初始化完成。</strong><br>如上所述，一个对象的内存只有在其所有储存型属性确定之后才能完全初始化。为了满足这一规则，指定初始化器必须保证它自己的属性在它上交委托之前先完成初始化。</p>
<h5 id="安全检查-2"><a href="#安全检查-2" class="headerlink" title="安全检查 2"></a>安全检查 2</h5><p><strong>指定初始化器必须先向上委托父类初始化器，然后才能为继承的属性设置新值。如果不这样做，指定初始化器赋予的新值将被父类中的初始化器所覆盖。</strong></p>
<h5 id="安全检查-3"><a href="#安全检查-3" class="headerlink" title="安全检查 3"></a>安全检查 3</h5><p><strong>便捷初始化器必须先委托同类中的其它初始化器，然后再为任意属性赋新值（包括同类里定义的属性）。如果没这么做，便捷构初始化器赋予的新值将被自己类中其它指定初始化器所覆盖。</strong></p>
<h5 id="安全检查-4"><a href="#安全检查-4" class="headerlink" title="安全检查 4"></a>安全检查 4</h5><p><strong>初始化器在第一阶段初始化完成之前，不能调用任何实例方法、不能读取任何实例属性的值，也不能引用 <code>self</code> 作为值。</strong></p>
<p>直到第一阶段结束类实例才完全合法。属性只能被读取，方法也只能被调用，直到第一阶段结束的时候，这个类实例才被看做是合法的。</p>
<p>以下是两段初始化过程，基于上述四种检查的流程：</p>
<h5 id="阶段-1"><a href="#阶段-1" class="headerlink" title="阶段 1"></a>阶段 1</h5><ul>
<li>指定或便捷初始化器在类中被调用；</li>
<li>为这个类的新实例分配内存。内存还没有被初始化；</li>
<li>这个类的指定初始化器确保所有由此类引入的存储属性都有一个值。现在这些存储属性的内存被初始化了；</li>
<li>指定初始化器上交父类的初始化器为其存储属性执行相同的任务；</li>
<li>这个调用父类初始化器的过程将沿着初始化器链一直向上进行，直到到达初始化器链的最顶部；</li>
<li>一旦达了初始化器链的最顶部，在链顶部的类确保所有的存储属性都有一个值，此实例的内存被认为完全初始化了，此时第一阶段完成。</li>
</ul>
<h5 id="阶段-2"><a href="#阶段-2" class="headerlink" title="阶段 2"></a>阶段 2</h5><ul>
<li>从顶部初始化器往下，链中的每一个指定初始化器都有机会进一步定制实例。初始化器现在能够访问 self 并且可以修改它的属性，调用它的实例方法等等；</li>
<li>最终，链中任何便捷初始化器都有机会定制实例以及使用 slef 。</li>
</ul>
<p>下面展示了<strong>第一阶段</strong>假定的子类和父类之间的初始化调用关系：<br><img style="margin: auto" src="/2017/11/28/Swift-initialization/twoPhaseInitialization01_2x.png" alt="twoPhaseInitialization01_2x" title="子类与父类阶段1关系图"></p>
<p>在这个栗子中，初始化过程从一个子类的便捷初始化器开始。这个便捷初始化器还不能修改任何属性。它委托给了同一类里的指定初始化器。</p>
<p>指定初始化器确保所有的子类属性都有值，如<em>安全检查1</em>。然后它调用父类的指定初始化器来沿着初始化器链一直往上完成父类的初始化过程。父类的指定初始化器确保所有的父类属性都有值。由于没有更多的父类来初始化，也就不需要更多的委托。一旦父类中所有属性都有初始值，它的内存就被认为完全初始化了，<em>第1阶段完成</em>。</p>
<p>下图是相同的初始化过程在<strong>第二阶段</strong>的样子：<br><img style="margin: auto" src="/2017/11/28/Swift-initialization/twoPhaseInitialization02_2x.png" alt="twoPhaseInitialization02_2x" title="初始化第二阶段关系图"><br>现在父类的指定初始化器有机会来定制更多实例(尽管没有这种必要)。一旦父类的指定初始化器完成了调用，子类的指定初始化器就可以执行额外的定制(同样，尽管没有这种必要)。</p>
<p>最后，一旦子类的指定初始化器完成，最初调用的便捷初始化器将会执行额外的定制操作。</p>
<h4 id="初始化器的继承和重写"><a href="#初始化器的继承和重写" class="headerlink" title="初始化器的继承和重写"></a>初始化器的继承和重写</h4><p>不像在 Objective-C 中的子类，Swift 的子类不会默认继承父类的初始化器。Swift 的这种机制防止父类的简单初始化器被一个更专用的子类继承并被用来创建一个没有完全或错误初始化的新实例的情况发生。</p>
<p>如果你想自定义子类来实现一个或多个和父类相同的初始化器，你可以在子类中为那些初始化器提供定制的实现。<br>当你写的子类初始化器匹配父类<em>指定初始化器的时候</em>，你实际上可以重写那个初始化器。因此，在子类的初始化器定义之前你必须写 <code>override</code> 修饰符。如同默认初始化器所描述的那样，即使是自动提供的默认初始化器你也可以重写。</p>
<p>相反，如同上边类类型的初始化器委托所描述的规则那样，如果你写了<strong>一个匹配父类便捷初始化器的子类初始化器</strong>，父类的便捷初始化器将永远不会通过你的子类直接调用。因此，你的子类不能(严格来讲)提供父类初始化器的重写。当提供一个匹配的父类便捷初始化器的实现时，你不用写 <code>override</code> 修饰符。</p>
<p>下面的栗子定义了一个名为 <code>Vehicle</code> 的基类。基类声明了一个名为 <code>numberOfWheels</code> 的存储属性，类型为 <code>Int</code> 的默认值 <code>0</code> 。 <code>numberOfWheels</code> 属性通过一个名为 <code>description</code> 的计算属性来创建一个 <code>String</code> 类型的车辆特征字符串描述：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vehicle</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> numberOfWheels = <span class="number">0</span></div><div class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"<span class="subst">\(numberOfWheels)</span> wheel(s)"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>Vehicle</code> 类只为它的存储属性提供了默认值，并且没有提供自定义的初始化器。因此，如同默认初始化器中描述的那样，它会自动收到一个默认初始化器。默认初始化器(如果可用的话)总是类的指定初始化器，也可以用来创建一个新的 <code>Vehicle</code> 实例， <code>numberOfWheels</code> 默认为 <code>0</code> ：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> vehicle = <span class="type">Vehicle</span>()</div><div class="line"><span class="built_in">print</span>(<span class="string">"Vehicle: <span class="subst">\(vehicle.description)</span>"</span>)</div><div class="line"><span class="comment">// Vehicle: 0 wheel(s)</span></div></pre></td></tr></table></figure>
<p>下面的例子定义了一个名为 <code>Bicycle</code> 继承自 <code>Vehicle</code> 的子类：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bicycle</span>: <span class="title">Vehicle</span> </span>&#123;</div><div class="line">    <span class="keyword">override</span> <span class="keyword">init</span>() &#123;</div><div class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</div><div class="line">        numberOfWheels = <span class="number">2</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>子类 <code>Bicycle</code> 定义了一个自定义初始化器 <code>init()</code> 。这个指定初始化器和 <code>Bicycle</code> 的父类的指定初始化器相匹配，所以 <code>Bicycle</code> 中的指定初始化器需要带上 <code>override</code> 修饰符。</p>
<p><code>Bicycle</code> 类的 <code>init()</code> 初始化器以调用 <code>super.init()</code> 开始，这个方法作用是调用父类的初始化器。这样可以确保 <code>Bicycle</code> 在修改属性之前它所继承的属性 <code>numberOfWheels</code> 能被 <code>Vehicle</code> 类初始化。在调用 <code>super.init()</code> 之后，一开始的 <code>numberOfWheels</code> 值会被新值 <code>2</code> 替换。</p>
<p>如果你创建一个 <code>Bicycle</code> 实例，你可以调用继承的 <code>description</code> 计算属性来查看属性 <code>numberOfWheels</code> 是否有改变。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> bicycle = <span class="type">Bicycle</span>()</div><div class="line"><span class="built_in">print</span>(<span class="string">"Bicycle: <span class="subst">\(bicycle.description)</span>"</span>)</div><div class="line"><span class="comment">// Bicycle: 2 wheel(s)</span></div></pre></td></tr></table></figure>
<h4 id="自动初始化器的继承"><a href="#自动初始化器的继承" class="headerlink" title="自动初始化器的继承"></a>自动初始化器的继承</h4><p>如上所述，<strong>子类默认不会继承父类初始化器</strong>。总之，<em>在特定的情况下父类初始化器是可以被自动继承的</em>。实际上，这意味着在许多场景中你不必重写父类初始化器，只要可以安全操作，你就可以毫不费力地继承父类的初始化器。</p>
<p>假设你为你子类引入的任何新的属性都提供了默认值，请遵守以下2个规则：</p>
<h5 id="规则-1"><a href="#规则-1" class="headerlink" title="规则 1"></a>规则 1</h5><p><strong>如果你的子类没有定义任何指定初始化器，它会自动继承父类所有的指定初始化器。</strong></p>
<h5 id="规则-2-1"><a href="#规则-2-1" class="headerlink" title="规则 2"></a>规则 2</h5><p>如果你的子类提供了所有父类<strong>指定初始化器的实现</strong>——要么是通过规则1继承来的，要么通过在定义中提供自定义实现的——那么它自动继承所有的父类便捷初始化器。</p>
<p>就算你的子类添加了更多的便捷初始化器，这些规则仍然适用。</p>
<blockquote>
<p>子类能够以便捷初始化器的形式实现父类指定初始化器来作为满足规则2的一部分。</p>
</blockquote>
<h4 id="指定和便捷初始化器的操作"><a href="#指定和便捷初始化器的操作" class="headerlink" title="指定和便捷初始化器的操作"></a>指定和便捷初始化器的操作</h4><p>下面的栗子展示了在操作中<em>指定初始化器</em>，<em>便捷初始化器</em>和<em>自动初始化器</em>的继承。这个栗子定义了 <code>Food</code> ， <code>RecipeIngredient</code> 和 <code>ShoppingListItem</code> 三个类的层级关系，并演示了它们的继承关系是如何相互作用的。</p>
<p>在层级关系中的基类称为 <code>Food</code> ，它是一个简单的类用来封装了食品的名称。 <code>Food</code> 类引入了一个名为 <code>name</code> 的 <code>String</code> 属性还提供了两个创建 <code>Food</code> 实例的初始化器：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Food</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> name: <span class="type">String</span></div><div class="line">    <span class="keyword">init</span>(name: <span class="type">String</span>) &#123; <span class="comment">//指定初始化器</span></div><div class="line">        <span class="keyword">self</span>.name = name</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">convenience</span> <span class="keyword">init</span>() &#123;<span class="comment">//便携初始化器</span></div><div class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(name: <span class="string">"[Unnamed]"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>下面的图表展示了 <code>Food</code> 类的初始化链：<br><img style="margin: auto" src="/2017/11/28/Swift-initialization/initializersExample01_2x.png" alt="initializersExample01_2x" title="Food类的初始化链"></p>
<p><em>类没有默认成员初始化器</em>，所以 <code>Food</code> 类提供了一个接受单一实际参数的指定初始化器叫做 <code>name</code> 。这个初始化器可以使用一个具体的名称来创建新的 <code>Food</code> 实例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> namedMeat = <span class="type">Food</span>(name: <span class="string">"Bacon"</span>)</div><div class="line"><span class="comment">// namedMeat's name is "Bacon"</span></div></pre></td></tr></table></figure>
<p><code>Food</code> 类的 i<code>nit(name: String)</code> 初始化器是一个<strong>指定初始化器</strong>，因为它确保 <code>Food</code> 类新实例的所有存储属性都被完全初始化。 <code>Food</code> 类没有父类，所以 <code>init(name: String)</code>初始化器不用调用 <code>super.init()</code> 来完成它的初始化。</p>
<p>Food 类也提供了没有实际参数的<strong>便捷初始化器</strong> <code>init()</code> 。 <code>init()</code> 初始化器通过委托调用同一类中定义的指定初始化器 <code>init(name: String)</code> 并给参数 <code>name</code> 传值 <code>[Unnamed]</code> 来实现提供默认的名称占位符：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> mysteryMeat = <span class="type">Food</span>()</div><div class="line"><span class="comment">// mysteryMeat's name is "[Unnamed]"</span></div></pre></td></tr></table></figure>
<p>类层级中的第二个类是 <code>Food</code> 的子类 <code>RecipeIngredient</code> 。 <code>RecipeIngredient</code> 类模型构建了食谱中一个调味剂。它引入了 <code>Int</code> 类型的数量属性 <code>quantity</code> （以及从 <code>Food</code> 继承过来的 <code>name</code> 属性)并且定义了两个初始化器来创建 <code>RecipeIngredient</code> 实例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">RecipeIngredient</span>: <span class="title">Food</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> quantity: <span class="type">Int</span></div><div class="line">    <span class="keyword">init</span>(name: <span class="type">String</span>, quantity: <span class="type">Int</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.quantity = quantity</div><div class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(name: name)</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">override</span> <span class="keyword">convenience</span> <span class="keyword">init</span>(name: <span class="type">String</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(name: name, quantity: <span class="number">1</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>下面的图标展示了 <code>RecipeIngredient</code> 了的初始化链:<br><img style="margin: auto" src="/2017/11/28/Swift-initialization/initializersExample02_2x.png" alt="initializersExample02_2x" title="RecipeIngredient初始化链"></p>
<p><code>RecipeIngredient</code> 类只有一个指定初始化器， <code>init(name: String, quantity: Int)</code> ，它可以用来填充新的 <code>RecipeIngredient</code> 实例中所有的属性。这个初始化器一开始先将传入的 <code>quantity</code> 实际参数赋值给 <code>quantity</code> 属性，这个属性也是唯一一个通过 <code>RecipeIngredient</code> 引入的新属性。随后，<strong>初始化器将向上委托给父类</strong> <code>Food</code> 的 <code>init(name: String)</code> 初始化器。这个过程满足上边所述的两段式初始化的<em>安全检查1</em>。</p>
<p><code>RecipeIngredient</code> 同样定义了一个便捷初始化器， <code>init(name: String)</code> ，它只通过<code>name</code>来创建 <code>RecipeIngredient</code> 的实例。这个便捷初始化器假设任意 <code>RecipeIngredient</code> 没有明确数量的实例的 <code>quantity</code> 值都为 <code>1</code>。便捷初始化器的定义让 <code>RecipeIngredient</code> 实例创建的方便更快捷，并且当创建多个单数实例时可以避免代码冗余。这个便捷初始化器只是简单的委托了类的指定初始化器，传递了值为 <code>1</code> 的 <code>quantity</code> 。</p>
<p><code>RecipeIngredient</code> 类提供的 <code>init(name: String)</code> 便捷初始化器接收与 <code>Food</code> 中指定初始化器 <code>init(name: String)</code> 相同的形式参数。因为这个便捷初始化器从它的父类重写了一个指定初始化器，它必须使用 <code>override</code> 修饰符。</p>
<p>尽管 <code>RecipeIngredient</code> 提供了 <code>init(name: String)</code> 初始化器作为一个<strong>便捷初始化器</strong>，然而 <code>RecipeIngredient</code> 类为所有的<em>父类指定初始化器</em>提供了实现。因此， <code>RecipeIngredient</code> 类<strong>也自动继承了父类所有的便捷初始化器</strong>。</p>
<p>在这个栗子中， <code>RecipeIngredient</code> 的父类是 <code>Food</code> ，它只有一个 <code>init()</code> <strong>便捷初始化器</strong>。因此这个初始化器也被 <code>RecipeIngredient</code> 类继承。这个继承的 <code>init()</code> 函数和 <code>Food</code> 提供的是一样的，除了它是委托给 <code>RecipeIngredient</code> 版本的 <code>init(name: String)</code> 而不是 <code>Food</code> 版本。</p>
<p>所有的这三种初始化器都可以用来创建新的 <code>RecipeIngredient</code> 实例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> oneMysteryItem = <span class="type">RecipeIngredient</span>()</div><div class="line"><span class="keyword">let</span> oneBacon = <span class="type">RecipeIngredient</span>(name: <span class="string">"Bacon"</span>)</div><div class="line"><span class="keyword">let</span> sixEggs = <span class="type">RecipeIngredient</span>(name: <span class="string">"Eggs"</span>, quantity: <span class="number">6</span>)</div></pre></td></tr></table></figure>
<p>类层级中第三个也是最后一个类是 <code>RecipeIngredient</code> 的子类，叫做 <code>ShoppingListItem</code> 。这个类构建了购物单中出现的某一种调味料。</p>
<p>在购物表里每一项都是从未购买状态开始的。为了展现这一事实， <code>ShoppingListItem</code> 引入了一个布尔类型的属性 <code>purchased</code> ，默认值 <code>false</code> 。 <code>ShoppingListItem</code> 也添加了一个计算属性 <code>description</code> 属性，它提供了关于 <code>ShoppingListItem</code> 实例的一些文字描述：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShoppingListItem1</span>: <span class="title">RecipeIngredient</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> purchased = <span class="literal">false</span></div><div class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123;</div><div class="line">        <span class="keyword">var</span> output = <span class="string">"<span class="subst">\(quantity)</span> x <span class="subst">\(name)</span>"</span></div><div class="line">        output += purchased ? <span class="string">" ✔"</span> : <span class="string">" ✘"</span></div><div class="line">        <span class="keyword">return</span> output</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p><code>ShoppingListItem</code> 没有定义初始化器来给 <code>purchased</code> 一个初始值，这是因为任何添加到购物单（这里的模型）的项的初始状态总是未购买。</p>
</blockquote>
<p>由于它为自己引入的所有属性提供了一个默认值并且自己没有定义任何初始化器， <code>ShoppingListItem</code> 会自动从<em>父类**</em>继承所有的指定和便捷初始化器**。</p>
<p>下图展示了三个类的初始化链：<br><img style="margin: auto" src="/2017/11/28/Swift-initialization/initializersExample03_2x.png" alt="initializersExample03_2x" title="初始化链图"></p>
<p>你可以使用全部三个继承来的初始化器来创建 <code>ShoppingListItem</code> 的新实例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> breakfastList = [</div><div class="line">    <span class="type">ShoppingListItem1</span>(),</div><div class="line">    <span class="type">ShoppingListItem1</span>(name: <span class="string">"Bacon"</span>),</div><div class="line">    <span class="type">ShoppingListItem1</span>(name: <span class="string">"Eggs"</span>, quantity: <span class="number">6</span>),</div><div class="line">]</div><div class="line">breakfastList[<span class="number">0</span>].name = <span class="string">"Orange juice"</span></div><div class="line">breakfastList[<span class="number">0</span>].purchased = <span class="literal">true</span></div><div class="line"><span class="keyword">for</span> item <span class="keyword">in</span> breakfastList &#123;</div><div class="line">    <span class="built_in">print</span>(item.description)</div><div class="line">&#125;</div><div class="line"><span class="comment">// 1 x Orange juice ✔</span></div><div class="line"><span class="comment">// 1 x Bacon ✘</span></div><div class="line"><span class="comment">// 6 x Eggs ✘</span></div></pre></td></tr></table></figure>
<p>这里，名为 <code>breakfastList</code> 的数组通过包含三个 <code>ShoppingListItem</code> 实例的数组字面量创建。数组的类型被推断为 <code>[ShoppingListItem]</code>。数组创建之后，数组第一个 <code>ShoppingListItem</code> 的 <code>name</code> 从 “<code>[Unnamed]</code>“ 修改为 <code>&quot;Orange juice&quot;</code> ，并且它的 <code>purchased</code> 也标记为了 <code>true</code> 。然后通过遍历打印每个数组的描述，展示了它们的默认状态都按照预期被设置了。</p>
<h3 id="可失败初始化器"><a href="#可失败初始化器" class="headerlink" title="可失败初始化器"></a>可失败初始化器</h3><p>定义类、结构体或枚举初始化时可以失败在某些情况下会管大用。这个失败可能由以下几种方式触发，包括给初始化传入无效的形式参数值，或缺少某种外部所需的资源，又或是其他阻止初始化的情况。</p>
<p>为了妥善处理这种可能失败的情况，在类、结构体或枚举中定义一个或多个可失败的初始化器。通过在 <code>init</code> <strong>关键字后面添加问号( <code>init?</code> )来写</strong>。</p>
<blockquote>
<p>你不能定义可失败和非可失败的初始化器为相同的形式参数类型和名称。</p>
</blockquote>
<p>可失败的初始化器创建了一个初始化类型的<strong>可选值</strong>。你通过在可失败初始化器写 <code>return nil</code> 语句，来表明可失败初始化器在何种情况下会触发初始化失败。</p>
<blockquote>
<p>严格来讲，初始化器不会有返回值。相反，它们的角色是确保在初始化结束时， <code>self</code> 能够被正确初始化。虽然你写了 <code>return nil</code> 来触发初始化失败，但是你不能使用 <code>return</code> 关键字来表示初始化成功了。</p>
</blockquote>
<p>比如说，可失败初始化器为数字类型转换器做实现。为了确保数字类型之间的转换保持值不变，使用 <code>init(exactly:)</code>  初始化器。如果类型转换不能保持值不变，初始化器失败。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> wholeNumber: <span class="type">Double</span> = <span class="number">12345.0</span></div><div class="line"><span class="keyword">let</span> pi = <span class="number">3.14159</span></div><div class="line"><span class="keyword">if</span> <span class="keyword">let</span> valueMaintained = <span class="type">Int</span>(exactly: wholeNumber) &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(wholeNumber)</span> conversion to int maintains value"</span>)</div><div class="line">&#125;</div><div class="line"><span class="keyword">let</span> valueChanged = <span class="type">Int</span>(exactly: pi)</div><div class="line"><span class="comment">// valueChanged is of type Int?, not Int</span></div><div class="line"><span class="keyword">if</span> valueChanged == <span class="literal">nil</span> &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(pi)</span> conversion to int does not maintain value"</span>);</div><div class="line">&#125;</div><div class="line"><span class="comment">// Prints "3.14159 conversion to int does not maintain value"</span></div></pre></td></tr></table></figure>
<p>面的栗子定义了一个名为 <code>Animal</code> 的结构体，有一个名为 <code>species</code> 的 <code>String</code> 类型常量属性。 <code>Animal</code> 结构体也定义了一个可失败初始化器，有一个形式参数 <code>species</code> 。这个初始化器用来检查传入 <code>species</code> 的字符串是否为空。如果发现了一个空字符串，初始化失败被触发。否则，就设置 <code>species</code> 属性的值，然后初始化成功：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Animal</span> </span>&#123;</div><div class="line">    <span class="keyword">let</span> species: <span class="type">String</span></div><div class="line">    <span class="keyword">init</span>?(species: <span class="type">String</span>) &#123;</div><div class="line">        <span class="keyword">if</span> species.isEmpty &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</div><div class="line">        <span class="keyword">self</span>.species = species</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>你可以通过可失败初始化器来尝试初始化一个新的 <code>Animal</code> 实例并且检查初始化是否成功：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> someCreature = <span class="type">Animal</span>(species: <span class="string">"Giraffe"</span>)</div><div class="line"><span class="comment">// someCreature is of type Animal?, not Animal</span></div><div class="line"> </div><div class="line"><span class="keyword">if</span> <span class="keyword">let</span> giraffe = someCreature &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"An animal was initialized with a species of <span class="subst">\(giraffe.species)</span>"</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// prints "An animal was initialized with a species of Giraffe"</span></div></pre></td></tr></table></figure>
<p>果你给可失败初始化器的 <code>species</code> 形式参数传了一个字符串值，始化器触发初始化失败：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> anonymousCreature = <span class="type">Animal</span>(species: <span class="string">""</span>)</div><div class="line"><span class="comment">// anonymousCreature is of type Animal?, not Animal</span></div><div class="line"> </div><div class="line"><span class="keyword">if</span> anonymousCreature == <span class="literal">nil</span> &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"The anonymous creature could not be initialized"</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// prints "The anonymous creature could not be initialized"</span></div></pre></td></tr></table></figure>
<h4 id="枚举的可失败初始化器"><a href="#枚举的可失败初始化器" class="headerlink" title="枚举的可失败初始化器"></a>枚举的可失败初始化器</h4><p>你可以使用一个可失败初始化器来在带一个或多个形式参数的枚举中选择合适的情况。如果提供的形式参数没有匹配合适的情况初始化器就可能失败。</p>
<p>下面的栗子定义一个名为 <code>TemperatureUnit</code> 的枚举，有三种可能的状态( <code>Kelvin</code> ， <code>Celsius</code> 和 <code>Fahrenheit</code> )。使用一个可失败初始化器来找一个合适用来表示气温符号的 <code>Character</code> 值：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">enum</span> <span class="title">TemperatureUnit</span> </span>&#123;</div><div class="line">    <span class="keyword">case</span> <span class="type">Kelvin</span>, <span class="type">Celsius</span>, <span class="type">Fahrenheit</span></div><div class="line">    <span class="keyword">init</span>?(symbol: <span class="type">Character</span>) &#123;</div><div class="line">        <span class="keyword">switch</span> symbol &#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">"K"</span>:</div><div class="line">            <span class="keyword">self</span> = .<span class="type">Kelvin</span></div><div class="line">        <span class="keyword">case</span> <span class="string">"C"</span>:</div><div class="line">            <span class="keyword">self</span> = .<span class="type">Celsius</span></div><div class="line">        <span class="keyword">case</span> <span class="string">"F"</span>:</div><div class="line">            <span class="keyword">self</span> = .<span class="type">Fahrenheit</span></div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>你可以使用可失败初始化器为可能的三种状态来选择一个合适的枚举情况，当参数的值不能与任意一枚举成员相匹配时，该枚举类型初始化失败：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> fahrenheitUnit = <span class="type">TemperatureUnit</span>(symbol: <span class="string">"F"</span>)</div><div class="line"><span class="keyword">if</span> fahrenheitUnit != <span class="literal">nil</span> &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"This is a defined temperature unit, so initialization succeeded."</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// prints "This is a defined temperature unit, so initialization succeeded."</span></div><div class="line"> </div><div class="line"><span class="keyword">let</span> unknownUnit = <span class="type">TemperatureUnit</span>(symbol: <span class="string">"X"</span>)</div><div class="line"><span class="keyword">if</span> unknownUnit == <span class="literal">nil</span> &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"This is not a defined temperature unit, so initialization failed."</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// prints "This is not a defined temperature unit, so initialization failed."</span></div></pre></td></tr></table></figure>
<h4 id="带有原始值枚举的可失败初始化器"><a href="#带有原始值枚举的可失败初始化器" class="headerlink" title="带有原始值枚举的可失败初始化器"></a>带有原始值枚举的可失败初始化器</h4><p><strong>带有原始值的枚举会自动获得一个可失败初始化器</strong> <code>init?(rawValue:)</code> ，该可失败初始化器接收一个名为 <code>rawValue</code> 的合适的原始值类型形式参数如果找到了匹配的枚举情况就选择其一，或者没有找到匹配的值就触发初始化失败。</p>
<p>你可以把上面的 <code>TemperatureUnit</code> 的栗子可以重写为使用 <code>Character</code> 原始值并带有改过的 <code>init?(rawValue:)</code> 初始化器：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">enum</span> <span class="title">TemperatureUnit</span>: <span class="title">Character</span> </span>&#123;</div><div class="line">    <span class="keyword">case</span> <span class="type">Kelvin</span> = <span class="string">"K"</span>, <span class="type">Celsius</span> = <span class="string">"C"</span>, <span class="type">Fahrenheit</span> = <span class="string">"F"</span></div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">let</span> fahrenheitUnit = <span class="type">TemperatureUnit</span>(rawValue: <span class="string">"F"</span>)</div><div class="line"><span class="keyword">if</span> fahrenheitUnit != <span class="literal">nil</span> &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"This is a defined temperature unit, so initialization succeeded."</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// prints "This is a defined temperature unit, so initialization succeeded."</span></div><div class="line"> </div><div class="line"><span class="keyword">let</span> unknownUnit = <span class="type">TemperatureUnit</span>(rawValue: <span class="string">"X"</span>)</div><div class="line"><span class="keyword">if</span> unknownUnit == <span class="literal">nil</span> &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"This is not a defined temperature unit, so initialization failed."</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// prints "This is not a defined temperature unit, so initialization failed."</span></div></pre></td></tr></table></figure>
<h4 id="初始化失败的传递"><a href="#初始化失败的传递" class="headerlink" title="初始化失败的传递"></a>初始化失败的传递</h4><p><strong>类，结构体或枚举的可失败初始化器可以横向委托到同一个类，结构体或枚举里的另一个可失败初始化器</strong>。类似地，子类的可失败初始化器可以向上委托到父类的可失败初始化器。</p>
<p>无论哪种情况，如果你委托到另一个初始化器导致了初始化失败，那么整个初始化过程也会立即失败，并且之后任何初始化代码都不会执行。</p>
<p>下面的栗子定义了 <code>Product</code> 类的子类 <code>CartItem</code> 。 <code>CartItem</code> 类建立了一个在线购物车中物品的模型。 <code>CartItem</code> 引入了一个名为 <code>quantity</code> 常量存储属性，并且确保了这个属性至少是 1 :</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</div><div class="line">    <span class="keyword">let</span> name: <span class="type">String</span></div><div class="line">    <span class="keyword">init</span>?(name: <span class="type">String</span>) &#123;</div><div class="line">        <span class="keyword">if</span> name.isEmpty &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">self</span>.name = name</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CartItem</span>: <span class="title">Product</span> </span>&#123;</div><div class="line">    <span class="keyword">let</span> quantily: <span class="type">Int</span></div><div class="line">    <span class="keyword">init</span>?(name: <span class="type">String</span>, quantily: <span class="type">Int</span>) &#123;</div><div class="line">        <span class="keyword">if</span> quantily &gt; <span class="number">1</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">self</span>.quantily = quantily</div><div class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(name: name)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//////////////////////////////////////</span></div><div class="line"><span class="keyword">if</span> <span class="keyword">let</span> twoSocks = <span class="type">CartItem</span>(name: <span class="string">"sock"</span>, quantity: <span class="number">2</span>) &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"Item: <span class="subst">\(twoSocks.name)</span>, quantity: <span class="subst">\(twoSocks.quantity)</span>"</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// prints "Item: sock, quantity: 2"</span></div><div class="line"></div><div class="line"><span class="comment">//////////////////////////////////////</span></div><div class="line"><span class="keyword">if</span> <span class="keyword">let</span> zeroShirts = <span class="type">CartItem</span>(name: <span class="string">"shirt"</span>, quantity: <span class="number">0</span>) &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"Item: <span class="subst">\(zeroShirts.name)</span>, quantity: <span class="subst">\(zeroShirts.quantity)</span>"</span>)</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"Unable to initialize zero shirts"</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// prints "Unable to initialize zero shirts"</span></div><div class="line"></div><div class="line"><span class="comment">//////////////////////////////////////</span></div><div class="line"><span class="keyword">if</span> <span class="keyword">let</span> oneUnnamed = <span class="type">CartItem</span>(name: <span class="string">""</span>, quantity: <span class="number">1</span>) &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"Item: <span class="subst">\(oneUnnamed.name)</span>, quantity: <span class="subst">\(oneUnnamed.quantity)</span>"</span>)</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"Unable to initialize one unnamed product"</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// prints "Unable to initialize one unnamed product"</span></div></pre></td></tr></table></figure>
<h4 id="重写可失败初始化器"><a href="#重写可失败初始化器" class="headerlink" title="重写可失败初始化器"></a>重写可失败初始化器</h4><p>你可以在子类里重写父类的可失败初始化器。就好比其他的初始化器。或者，你可以用子类的非可失败初始化器来重写父类可失败初始化器。这样允许你定义一个初始化不会失败的子类，尽管父类的初始化允许失败。</p>
<p><strong>注意如果你用非可失败的子类初始化器重写了一个可失败初始化器，向上委托到父类初始化器的唯一办法是强制展开父类初始化器的结果</strong></p>
<blockquote>
<p>你可以用一个非可失败初始化器重写一个可失败初始化器，但反过来是不行的。</p>
</blockquote>
<p>下面的栗子定义了一个名为 <code>Document</code> 的类。这个类建模了一个文档，其中的 <code>name</code> 属性要么是一个非空的字符串值要么为 <code>nil</code> ，但不能是一个空字符串：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Document</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> name: <span class="type">String</span>?</div><div class="line">    <span class="comment">// this initializer creates a document with a nil name value</span></div><div class="line">    <span class="keyword">init</span>() &#123;&#125;</div><div class="line">    <span class="comment">// this initializer creates a document with a non-empty name value</span></div><div class="line">    <span class="keyword">init</span>?(name: <span class="type">String</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.name = name</div><div class="line">        <span class="keyword">if</span> name.isEmpty &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>下面这个栗子定义了一个名为 <code>AutomaticallyNamedDocument</code> 的 <code>Document</code> 类的子类。这个子类重写了 <code>Document</code> 类引入的两个指定初始化器。这些重写确保了 <code>AutomaticallyNamedDocument</code> 实例在初始化时没有名字或者传给 <code>init(name:)</code> 初始化器一个空字符串时 <code>name</code> 的初始值为 “<code>[Untitled]</code>“ ：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AutomaticallyNamedDocument</span>: <span class="title">Document</span> </span>&#123;</div><div class="line">    <span class="keyword">override</span> <span class="keyword">init</span>() &#123;</div><div class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</div><div class="line">        <span class="keyword">self</span>.name = <span class="string">"[Untitled]"</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">override</span> <span class="keyword">init</span>(name: <span class="type">String</span>) &#123;</div><div class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</div><div class="line">        <span class="keyword">if</span> name.isEmpty &#123;</div><div class="line">            <span class="keyword">self</span>.name = <span class="string">"[Untitled]"</span></div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">self</span>.name = name</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>AutomaticallyNamedDocument</code> 类用非可失败的 <code>init(name:)</code> 初始化器重写了父类的可失败 <code>init?(name:)</code> 初始化器。因为 <code>AutomaticallyNamedDocument</code> 类用不同的方式处理了空字符串的情况，它的初始化器不会失败，所以它提供了非可失败初始化器来代替。</p>
<p>你可以在初始化器里使用强制展开来从父类调用一个可失败初始化器作为子类非可失败初始化器的一部分。例如，下边的 <code>UntitledDocument</code> 子类将总是被命名为 “<code>[Untitled]</code>“ ，并且在初始化期间它使用了父类的可失败 <code>init(name:)</code> 初始化器：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UntitledDocument</span>: <span class="title">Document</span> </span>&#123;</div><div class="line">    <span class="keyword">override</span> <span class="keyword">init</span>() &#123;</div><div class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(name: <span class="string">"[Untitled]"</span>)!</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这种情况下，如果父类的<code>init(name:)</code>初始化器曾以空字符串做名字调用，强制展开操作会导致运行时错误。总之，由于它调用了一个字符串常量，那么你可以看到初始化器不会失败，所以这时不会有运行时错误发生。</p>
<h4 id="可失败初始化器-init"><a href="#可失败初始化器-init" class="headerlink" title="可失败初始化器 init!"></a>可失败初始化器 init!</h4><p>通常来讲我们通过在 <code>init</code> 关键字后添加问号 ( <code>init?</code> )的方式来定义一个可失败初始化器以创建一个合适类型的可选项实例。另外，你也可以使用可失败初始化器创建一个<strong>隐式展开具有合适类型的可选项实例</strong>。通过在 <code>init</code> <strong>后面添加惊叹号</strong>( <code>init!</code> )是不是问号。</p>
<p>你可以在 <code>init?</code> 初始化器中<em>委托</em>调用 <code>init!</code> 初始化器，反之亦然。 你也可以用 <code>init!</code> 重写 <code>init?</code> ，反之亦然。 你还可以用 <code>init</code> 委托调用 <code>init!</code> ，尽管当 <code>init!</code> 初始化器导致初始化失败时会触发断言。</p>
<h3 id="必要初始化器"><a href="#必要初始化器" class="headerlink" title="必要初始化器"></a>必要初始化器</h3><p>在类的初始化器前添加 <code>required</code>  修饰符来表明所有该类的子类都必须实现该初始化器：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span> </span>&#123;</div><div class="line">    <span class="keyword">required</span> <span class="keyword">init</span>() &#123;</div><div class="line">        <span class="comment">// initializer implementation goes here</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当子类重写父类的必要初始化器时，必须在子类的初始化器前同样添加 <code>required</code> 修饰符以确保当其它类继承该子类时，该初始化器同为必要初始化器。在重写父类的必要初始化器时，<strong>不需要添加</strong> <code>override</code> 修饰符：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeSubclass</span>: <span class="title">SomeClass</span> </span>&#123;</div><div class="line">    <span class="keyword">required</span> <span class="keyword">init</span>() &#123;</div><div class="line">        <span class="comment">// subclass implementation of the required initializer goes here</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="通过闭包和函数来设置属性的默认值"><a href="#通过闭包和函数来设置属性的默认值" class="headerlink" title="通过闭包和函数来设置属性的默认值"></a>通过闭包和函数来设置属性的默认值</h3><p>如果某个存储属性的默认值需要自定义或设置，你可以使用<strong>要自</strong>或<strong>全局函数</strong>来为属性提供默认值。当这个属性属于的实例初始化时，<strong>闭包</strong>或<strong>函数</strong>就会被调用，并且它的返回值就会作为属性的默认值。</p>
<p><em>这种闭包或函数通常会创建一个和属性相同的临时值，处理这个值以表示初始的状态，并且把这个临时值返回作为属性的默认值。</em></p>
<p>下面的代码框架展示了闭包是如何提供默认值给属性的：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span> </span>&#123;</div><div class="line">    <span class="keyword">let</span> someProperty: <span class="type">SomeType</span> = &#123;</div><div class="line">        <span class="comment">// create a default value for someProperty inside this closure</span></div><div class="line">        <span class="comment">// someValue must be of the same type as SomeType</span></div><div class="line">        <span class="keyword">return</span> someValue</div><div class="line">    &#125;()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>注意闭包花括号的结尾跟一个没有参数的圆括号</strong>。这是告诉 Swift 立即执行闭包。如果你忽略了这对圆括号，你就会把闭包作为值赋给了属性，并且不会返回闭包的值。</p>
<blockquote>
<p>如果你使用了闭包来初始化属性，请记住闭包执行的时候，实例的其他部分还没有被初始化。这就意味着你不能在闭包里读取任何其他的属性值，即使这些属性有默认值。你也不能使用隐式 <code>self</code> 属性，或者调用实例的方法。</p>
</blockquote>
<p>下面的栗子定义了一个名为 <code>Checkerboard</code> 结构体，建模了一个国际象棋的棋盘。国际象棋在一个<code>8×8</code>的棋盘上进行，这里我们用黑白色块来代替。<br><img style="margin: auto" src="/2017/11/28/Swift-initialization/chessBoard_2x.png" alt="chessBoard_2x" title="棋盘"></p>
<p>为了呈现游戏的棋盘， <code>Checkerboard</code> 结构体只有一个名为 <code>boardColors</code> 的属性，它是一个包含100个 <code>Bool</code> 值的数组。数组中的 <code>true</code> 代表黑色的格子， <code>false</code> 代表白色的格子。数组中第一项代表棋盘的左上角方格，数组最后一项代表棋盘的右下角方格。</p>
<p><code>boardColors</code> <strong>数组在一个闭包里初始化，来设置它的颜色值</strong>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Chessboard</span> </span>&#123;</div><div class="line">    <span class="keyword">let</span> boardColors: [<span class="type">Bool</span>] = &#123;</div><div class="line">        <span class="keyword">var</span> temporaryBoard = [<span class="type">Bool</span>]()</div><div class="line">        <span class="keyword">var</span> isBlack = <span class="literal">false</span></div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span>...<span class="number">8</span> &#123;</div><div class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="number">1</span>...<span class="number">8</span> &#123;</div><div class="line">                temporaryBoard.append(isBlack)</div><div class="line">                isBlack = !isBlack</div><div class="line">            &#125;</div><div class="line">            isBlack = !isBlack</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> temporaryBoard</div><div class="line">    &#125;()</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">squareIsBlackAt</span><span class="params">(row: Int, column: Int)</span></span> -&gt; <span class="type">Bool</span> &#123;</div><div class="line">        <span class="keyword">return</span> boardColors[(row * <span class="number">8</span>) + column]</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>无论何时，创建一个新的 <code>Checkboard</code> ，闭包就会执行，并且 <code>boardColors</code> 的默认值就会计算和返回。上面栗子中的闭包在一个名为 <code>temporaryBoard</code> 的临时数组中为每个方格计算并且设置合适的颜色，然后一旦设置完毕，就把这个临时数组作为闭包的返回值返回。返回的数组值储存在 <code>boardColors</code> 中，并且可以通过 <code>squareIsBlackAtRow</code> 工具函数来查询：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> board = <span class="type">Chessboard</span>()</div><div class="line"><span class="built_in">print</span>(board.squareIsBlackAt(row: <span class="number">0</span>, column: <span class="number">1</span>))</div><div class="line"><span class="comment">// Prints "true"</span></div><div class="line"><span class="built_in">print</span>(board.squareIsBlackAt(row: <span class="number">7</span>, column: <span class="number">7</span>))</div><div class="line"><span class="comment">// Prints "false"</span></div></pre></td></tr></table></figure>
<blockquote>
<p>摘自：<a href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/Swift_Programming_Language/index.html#//apple_ref/doc/uid/TP40014097-CH3-ID0" target="_blank" rel="external">swift 官网</a><br>所有代码在Xcode9 Swift4 环境编译没问题，代码<a href="https://github.com/keshiim/LearnSwift4" target="_blank" rel="external">戳这里 https://github.com/keshiim/LearnSwift4</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://keshiim.github.io/2017/11/28/Leetcode-88M-erge-Sorted-Array/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng keshiim">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Farmer, keshiim 播种太阳🌞">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/28/Leetcode-88M-erge-Sorted-Array/" itemprop="url">Leetcode-88 Merge Sorted Array</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-28T14:23:53+08:00">
                2017-11-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index">
                    <span itemprop="name">LeetCode</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/28/Leetcode-88M-erge-Sorted-Array/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/28/Leetcode-88M-erge-Sorted-Array/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/11/28/Leetcode-88M-erge-Sorted-Array/" class="leancloud_visitors" data-flag-title="Leetcode-88 Merge Sorted Array">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://leetcode.com/problems/merge-sorted-array/description/" target="_blank" rel="external">Merge Sorted Array 合并有序数组</a></p>
<h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>Given two sorted integer arrays <em>nums1</em> and <em>nums2</em>, merge <em>nums2</em> into <em>nums1</em> as one sorted array.</p>
<h3 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h3><p>You may assume that <em>nums1</em> has enough space (size that is greatr or equal to <em>m + n</em>) to hold additional elements from <em>nums2</em>. The number of elements initialized in <em>nums1</em> and <em>nums2</em> are <em>m</em> and <em>n</em> respectively.</p>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>混合插入两个有序数组，由于俩数组都是后续的，只需要按顺序比较大小即可。</p>
<h3 id="解法一"><a href="#解法一" class="headerlink" title="解法一"></a>解法一</h3><p>最先想到的方法就是建立一个<code>m + n</code>大小的新数组，然后逐个从<code>num1</code>和<code>num2</code>数组中去除元素比较，把较小的加入新数组中，然后考虑<code>nums1</code>数组有剩余和<code>nums2</code>数组有剩余的两种情况，最后把新数组的元素重新赋值到<code>nums1</code>数组中即可，代码如下：</p>
<h4 id="Cpp"><a href="#Cpp" class="headerlink" title="Cpp"></a>Cpp</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums1, <span class="keyword">int</span> m, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums2, <span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (m &lt;= <span class="number">0</span> &amp;&amp; n &lt;= <span class="number">0</span>) <span class="keyword">return</span>;</div><div class="line">        <span class="keyword">int</span> a = <span class="number">0</span>, b = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> merged[m + n];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m + n; i++) &#123;</div><div class="line">            <span class="keyword">if</span> (a &lt; m &amp;&amp; b &lt; n) &#123;</div><div class="line">                <span class="keyword">if</span> (nums1[a] &lt; nums2[b]) &#123;</div><div class="line">                    merged[i] = nums1[a];</div><div class="line">                    ++a;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    merged[i] = nums2[b];</div><div class="line">                    ++b;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (a &lt; m &amp;&amp; b &gt;= n) &#123;</div><div class="line">                merged[i] = nums1[a];</div><div class="line">                ++a;            </div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (a &gt;= m &amp;&amp; b &lt; n) &#123;</div><div class="line">                merged[i] = nums2[b];</div><div class="line">                ++b;          </div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m + n; i++) nums1[i] = merged[i];</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="Swift"><a href="#Swift" class="headerlink" title="Swift"></a>Swift</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">merge</span><span class="params">(<span class="number">_</span> nums1: <span class="keyword">inout</span> [Int], <span class="number">_</span> m: Int, <span class="number">_</span> nums2: [Int], <span class="number">_</span> n: Int)</span></span> &#123;</div><div class="line">        <span class="keyword">if</span> m &lt;= <span class="number">0</span> &amp;&amp; n &lt;= <span class="number">0</span> &#123;</div><div class="line">            <span class="keyword">return</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">var</span> a = <span class="number">0</span>, b = <span class="number">0</span></div><div class="line">        <span class="keyword">var</span> merged = [<span class="type">Int</span>](repeatElement(<span class="number">0</span>, <span class="built_in">count</span>: m + n))</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..&lt;m + n &#123;</div><div class="line">            <span class="keyword">if</span> a &lt; m &amp;&amp; b &lt; n &#123;</div><div class="line">                <span class="comment">//都有数据</span></div><div class="line">                <span class="keyword">if</span> nums1[a] &lt; nums2[b] &#123;</div><div class="line">                    merged[i] = nums1[a];</div><div class="line">                    a += <span class="number">1</span></div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    merged[i] = nums2[b]</div><div class="line">                    b += <span class="number">1</span></div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> a &lt; m &amp;&amp; b &gt;= n &#123;</div><div class="line">                <span class="comment">// nums2 耗尽</span></div><div class="line">                merged[i] = nums1[a]</div><div class="line">                a += <span class="number">1</span></div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> a &gt;= m &amp;&amp; b &lt; n &#123;</div><div class="line">                <span class="comment">// nums1 耗尽</span></div><div class="line">                merged[i] = nums2[b]</div><div class="line">                b += <span class="number">1</span></div><div class="line">            &#125; <span class="keyword">else</span>  &#123;</div><div class="line">                <span class="keyword">return</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..&lt;m + n &#123;</div><div class="line">            nums1[i] = merged[i]</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="解法二"><a href="#解法二" class="headerlink" title="解法二"></a>解法二</h3><p>上述解法固然没错，但是还有更简洁的办法，而且不用申请新变量。算法思想是：由于合并后的<code>nums1</code>数组的大小必定是<code>m + n</code>，所以从最后面开始往前赋值，先比较<code>nums1</code>和<code>nums2</code>中最后一个元素的大小，把较大的那个插入到<code>m + n - 1</code>的位置上，再依次向前推。如果<code>nums1</code>中所有的元素都比<code>nums2</code>中的小，那么前<code>m</code>个元素都是<code>nums1</code>的内容，没有改变。如果<code>nums1</code>中的数组比<code>nums2</code>大的，当<code>nums1</code>循环完后，<code>nums2</code>中还有剩余元素没有加入到<code>nums1</code>，直接用个循环把<code>nums2</code>中所有的元素覆盖到<code>nums1</code>剩下的位置中。代码如下：</p>
<h4 id="Cpp-1"><a href="#Cpp-1" class="headerlink" title="Cpp"></a>Cpp</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums1, <span class="keyword">int</span> m, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums2, <span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> count = m + n - <span class="number">1</span>;</div><div class="line">        --m; --n;</div><div class="line">        <span class="keyword">while</span> (m &gt;= <span class="number">0</span> &amp;&amp; n &gt;= <span class="number">0</span>) nums1[count--] = nums1[m] &gt; nums2[n] ? nums1[m--] : nums2[n--];</div><div class="line">        <span class="keyword">while</span> (n &gt;= <span class="number">0</span>) nums1[count--] = nums2[n--];</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="Swift-1"><a href="#Swift-1" class="headerlink" title="Swift"></a>Swift</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">merge</span><span class="params">(<span class="number">_</span> nums1: <span class="keyword">inout</span> [Int], <span class="number">_</span> m: Int, <span class="number">_</span> nums2: [Int], <span class="number">_</span> n: Int)</span></span> &#123;</div><div class="line">        <span class="keyword">var</span> <span class="built_in">count</span> = m + n - <span class="number">1</span></div><div class="line">        <span class="keyword">var</span> m = m - <span class="number">1</span></div><div class="line">        <span class="keyword">var</span> n = n - <span class="number">1</span></div><div class="line">        <span class="keyword">while</span> m &gt;= <span class="number">0</span> &amp;&amp; n &gt;= <span class="number">0</span> &#123;</div><div class="line">            <span class="keyword">if</span> nums1[m] &gt; nums2[n] &#123;</div><div class="line">                nums1[<span class="built_in">count</span>] = nums1[m];</div><div class="line">                m -= <span class="number">1</span></div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                nums1[<span class="built_in">count</span>] = nums2[n]</div><div class="line">                n -= <span class="number">1</span></div><div class="line">            &#125;</div><div class="line">            <span class="built_in">count</span> -= <span class="number">1</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">while</span> n &gt;= <span class="number">0</span> &#123;</div><div class="line">            nums1[<span class="built_in">count</span>] = nums2[n]</div><div class="line">            <span class="built_in">count</span> -= <span class="number">1</span></div><div class="line">            n -= <span class="number">1</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://keshiim.github.io/2017/11/24/Leetcode-309-Best-Time-to-Buy-and-Sell-Stock-with-Cooldown/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng keshiim">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Farmer, keshiim 播种太阳🌞">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/24/Leetcode-309-Best-Time-to-Buy-and-Sell-Stock-with-Cooldown/" itemprop="url">Leetcode-309 Best Time to Buy and Sell Stock with Cooldown</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-24T14:14:04+08:00">
                2017-11-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index">
                    <span itemprop="name">LeetCode</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/24/Leetcode-309-Best-Time-to-Buy-and-Sell-Stock-with-Cooldown/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/24/Leetcode-309-Best-Time-to-Buy-and-Sell-Stock-with-Cooldown/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/11/24/Leetcode-309-Best-Time-to-Buy-and-Sell-Stock-with-Cooldown/" class="leancloud_visitors" data-flag-title="Leetcode-309 Best Time to Buy and Sell Stock with Cooldown">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>Say you have an array for which the $i^{th}$ element is the price of a given stock on day i.</p>
<p>Design an algorithm to find the maximum profit. You may complete as many transactions as you like (ie, buy one and sell one share of the stock multiple times) with the following restrictions:</p>
<ul>
<li>You may not engage in multiple transactions at the same time (ie, you must sell the stock before you buy again).</li>
<li>After you sell your stock, you cannot buy stock on next day. (ie, cooldown 1 day)</li>
</ul>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">prices = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">2</span>]</div><div class="line">maxProfit = <span class="number">3</span></div><div class="line">transactions = [buy, sell, cooldown, buy, sell]</div></pre></td></tr></table></figure>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>而这道题与上面这些不同之处在于加入了一个冷冻期<code>Cooldown</code>之说，就是如果某天卖了股票，那么第二天不能买股票，有一天的冷冻期。此题需要维护三个一维数组<code>buy</code>, <code>sell</code>，和<code>rest</code>。其中：</p>
<ul>
<li><code>buy[i]</code>表示在第<code>i</code>天之前最后一个操作是买，此时的最大收益。</li>
<li><code>sell[i]</code>表示在第<code>i</code>天之前最后一个操作是卖，此时的最大收益。</li>
<li><code>rest[i]</code>表示在第<code>i</code>天之前最后一个操作是冷冻期，此时的最大收益。</li>
</ul>
<p>我们写出递推式为：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">buy[i]  = max(rest[i<span class="number">-1</span>] - price, buy[i<span class="number">-1</span>]) </div><div class="line">sell[i] = max(buy[i<span class="number">-1</span>] + price, sell[i<span class="number">-1</span>])</div><div class="line">rest[i] = max(sell[i<span class="number">-1</span>], buy[i<span class="number">-1</span>], rest[i<span class="number">-1</span>])</div></pre></td></tr></table></figure>
<p>上述递推式很好的表示了在买之前有冷冻期，买之前要卖掉之前的股票。<strong>一个小技巧是如何保证<code>[buy, rest, buy]</code>的情况不会出现</strong>，这是由于<code>buy[i] &lt;= rest[i]</code>， 即<code>rest[i] = max(sell[i-1], rest[i-1])</code>，这保证了<code>[buy, rest, buy]</code>不会出现。</p>
<p>所以递推公式可以变成：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">buy[i]  = max(rest[i<span class="number">-1</span>] - price, buy[i<span class="number">-1</span>]) </div><div class="line">sell[i] = max(buy[i<span class="number">-1</span>] + price, sell[i<span class="number">-1</span>])</div><div class="line">rest[i] = max(sell[i<span class="number">-1</span>], rest[i<span class="number">-1</span>])</div></pre></td></tr></table></figure>
<p>另外，由于冷冻期的存在，我们可以得出<code>rest[i] = sell[i-1]</code>，这样，我们可以将上面三个递推式精简到两个：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">buy[i]  = max(sell[i<span class="number">-2</span>] - price, buy[i<span class="number">-1</span>]) </div><div class="line">sell[i] = max(buy[i<span class="number">-1</span>] + price, sell[i<span class="number">-1</span>])</div></pre></td></tr></table></figure>
<p>我们还可以做进一步优化，由于<code>i</code>只依赖于<code>i-1</code>和<code>i-2</code>，所以我们可以在<code>O(1)</code>的空间复杂度完成算法，参见代码如下：</p>
<h4 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; prices)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> buy = INT_MIN, pre_buy = <span class="number">0</span>, sell = <span class="number">0</span>, pre_sell = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> price : prices) &#123;</div><div class="line">            pre_buy = buy;</div><div class="line">            buy = max(pre_sell - price, pre_buy);</div><div class="line">            pre_sell = sell;</div><div class="line">            sell = max(pre_buy + price, pre_sell);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> sell;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="Swift"><a href="#Swift" class="headerlink" title="Swift"></a>Swift</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">maxProfit</span><span class="params">(<span class="number">_</span> prices: [Int])</span></span> -&gt; <span class="type">Int</span> &#123;</div><div class="line">        <span class="keyword">var</span> pre_buy = <span class="number">0</span>, buy = <span class="type">Int</span>.<span class="built_in">min</span>, pre_sell = <span class="number">0</span>, sell = <span class="number">0</span></div><div class="line">        <span class="keyword">for</span> price <span class="keyword">in</span> prices &#123;</div><div class="line">            pre_buy = buy</div><div class="line">            buy = <span class="built_in">max</span>(pre_sell - price, pre_buy)</div><div class="line">            pre_sell = sell</div><div class="line">            sell = <span class="built_in">max</span>(pre_buy + price, pre_sell)</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> sell</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>###另一种解法<br><a href="http://blog.csdn.net/qingyujean/article/details/51482041" target="_blank" rel="external">参考链接</a></p>
<h3 id="相关题目："><a href="#相关题目：" class="headerlink" title="相关题目："></a>相关题目：</h3><ul>
<li><a href="https://keshiim.github.io/2017/11/24/Leetcode-188-Best-Time-to-Buy-and-Sell-Stock-IV/">Best Time to Buy and Sell Stock IV</a></li>
<li><a href="https://keshiim.github.io/2017/11/24/Leetcode-123-Best-Time-to-Buy-and-Sell-Stock-III/">Best Time to Buy and Sell Stock III</a></li>
<li><a href="https://keshiim.github.io/2017/11/24/Leetcode-122-Best-Time-to-Buy-and-Sell-Stock-II/">Best Time to Buy and Sell Stock II</a></li>
<li><a href="https://keshiim.github.io/2017/11/24/Leetcode-121-Best-Time-to-Buy-and-Sell-Stock/">Best Time to Buy and Sell Stock</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://keshiim.github.io/2017/11/24/Leetcode-188-Best-Time-to-Buy-and-Sell-Stock-IV/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng keshiim">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Farmer, keshiim 播种太阳🌞">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/24/Leetcode-188-Best-Time-to-Buy-and-Sell-Stock-IV/" itemprop="url">Leetcode-188 Best Time to Buy and Sell Stock IV</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-24T14:10:23+08:00">
                2017-11-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index">
                    <span itemprop="name">LeetCode</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/24/Leetcode-188-Best-Time-to-Buy-and-Sell-Stock-IV/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/24/Leetcode-188-Best-Time-to-Buy-and-Sell-Stock-IV/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/11/24/Leetcode-188-Best-Time-to-Buy-and-Sell-Stock-IV/" class="leancloud_visitors" data-flag-title="Leetcode-188 Best Time to Buy and Sell Stock IV">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iv/description/" target="_blank" rel="external">Best Time to Buy and Sell Stock IV 面股票的最佳时间之四</a></p>
<h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>Say you have an array for which the $i^{th}$ element is the price of a given stock on day i.</p>
<p>Design an algorithm to find the maximum profit. You may complete at most <strong>K</strong> transactions.</p>
<h3 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h3><p>You may not engage in multiple transactions at the same time (ie, you must sell the stock befor you buy again).</p>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>这道题实际上是之前那道<a href="https://keshiim.github.io/2017/11/24/Leetcode-123-Best-Time-to-Buy-and-Sell-Stock-III/">Best Time to Buy and Sell Stock III 买股票的最佳时间之三</a>的一半情况的推广，还是需要用动态规划（Dynamic programming）来解决，其思路如下：</p>
<p>这里我们需要两个递推公式来分别更新两个变量<code>local</code>和<code>global</code>，我们其实可以求至少<code>k</code>次交易的最大利润。<br>我们定义<code>local[i][j]</code>为在到达第<code>i</code>天时最多可进行j次交易并且最后一次交易在最后一天卖出的最大利润，此为局部最优。<br>然后我们定义<code>global[i][j]</code>为在到达第i天时最多可进行j次交易的最大利润，此为全局最优。它们的递推式为：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">local[i][j] = max(global[i - <span class="number">1</span>][j - <span class="number">1</span>] + max(diff, <span class="number">0</span>), local[i - <span class="number">1</span>][j] + diff)</div><div class="line"></div><div class="line">global[i][j] = max(local[i][j], global[i - <span class="number">1</span>][j])，</div></pre></td></tr></table></figure>
<p>其中局部最优值是比较前一天并少交易一次的全局最优加上<strong>大于0的差值</strong>，和前一天的局部最优加上差值后相比，两者之中取较大值，而全局最优比较局部最优和前一天的全局最优。</p>
<p>但这道题还有个坑，就是如果k的值远大于<code>prices</code>的天数，比如<code>k</code>是好几百万，而<code>prices</code>的天数就为若干天的话，上面的<strong>DP</strong>解法就非常的没有效率，应该直接用<a href="https://keshiim.github.io/2017/11/24/Leetcode-122-Best-Time-to-Buy-and-Sell-Stock-II/">Best Time to Buy and Sell Stock II</a> 买股票的最佳时间之二的方法来求解，所以实际上这道题是之前的二和三的综合体，代码如下：</p>
<h3 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h3><h4 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="keyword">int</span> k, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;prices)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (prices.empty()) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span> (k &gt;= prices.size()) <span class="keyword">return</span> solveMaxProfit(prices);</div><div class="line">        <span class="keyword">int</span> g[k + <span class="number">1</span>] = &#123;<span class="number">0</span>&#125;;</div><div class="line">        <span class="keyword">int</span> l[k + <span class="number">1</span>] = &#123;<span class="number">0</span>&#125;;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; prices.size() - <span class="number">1</span>; i++) &#123;</div><div class="line">            <span class="keyword">int</span> diff = prices[i + <span class="number">1</span>] - prices[i];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = k; j &gt;= <span class="number">1</span>; j--) &#123;</div><div class="line">                l[j] = max(g[j - <span class="number">1</span>] + max(diff, <span class="number">0</span>), l[j] + diff);</div><div class="line">                g[j] = max(g[j], l[j]);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> g[k];</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">solveMaxProfit</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;prices)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; prices.size(); i++) &#123;</div><div class="line">            <span class="keyword">if</span> (prices[i] - prices[i - <span class="number">1</span>] &gt; <span class="number">0</span>) &#123;</div><div class="line">                res += prices[i] - prices[i - <span class="number">1</span>];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> res;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="Swift"><a href="#Swift" class="headerlink" title="Swift"></a>Swift</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">maxProfit</span><span class="params">(<span class="number">_</span> k: Int, <span class="number">_</span> prices: [Int])</span></span> -&gt; <span class="type">Int</span> &#123;</div><div class="line">        <span class="keyword">if</span> prices.isEmpty &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> prices.<span class="built_in">count</span> &lt;= k &#123;</div><div class="line">            <span class="keyword">return</span> solveMaxProfit(prices)</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">var</span> g = [<span class="type">Int</span>](repeatElement(<span class="number">0</span>, <span class="built_in">count</span>: k + <span class="number">1</span>))</div><div class="line">        <span class="keyword">var</span> l = [<span class="type">Int</span>](repeatElement(<span class="number">0</span>, <span class="built_in">count</span>: k + <span class="number">1</span>))</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..&lt;prices.<span class="built_in">count</span> - <span class="number">1</span> &#123;</div><div class="line">            <span class="keyword">let</span> diff = prices[i + <span class="number">1</span>] - prices[i]</div><div class="line">            <span class="keyword">var</span> j = k</div><div class="line">            <span class="keyword">while</span> (j &gt;= <span class="number">1</span>) &#123;</div><div class="line">                l[j] = <span class="built_in">max</span>(g[j - <span class="number">1</span>] + <span class="built_in">max</span>(<span class="number">0</span>, diff), l[j] + diff)</div><div class="line">                g[j] = <span class="built_in">max</span>(l[j], g[j])</div><div class="line">                j -= <span class="number">1</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> g[k]</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">solveMaxProfit</span><span class="params">(<span class="number">_</span> prices: [Int])</span></span> -&gt; <span class="type">Int</span> &#123;</div><div class="line">        <span class="keyword">var</span> res = <span class="number">0</span></div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span>..&lt;prices.<span class="built_in">count</span> &#123;</div><div class="line">            <span class="keyword">if</span> prices[i] - prices[i - <span class="number">1</span>] &gt; <span class="number">0</span> &#123;</div><div class="line">                res += prices[i] - prices[i - <span class="number">1</span>]</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> res</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="相关题目"><a href="#相关题目" class="headerlink" title="相关题目"></a>相关题目</h3><ul>
<li><a href="https://keshiim.github.io/2017/11/24/Leetcode-309-Best-Time-to-Buy-and-Sell-Stock-with-Cooldown/">Best Time to Buy and Sell Stock with Cooldown</a></li>
<li><a href="https://keshiim.github.io/2017/11/24/Leetcode-121-Best-Time-to-Buy-and-Sell-Stock/">Best Time to Buy and Sell Stock</a></li>
<li><a href="https://keshiim.github.io/2017/11/24/Leetcode-123-Best-Time-to-Buy-and-Sell-Stock-III/">Best Time to Buy and Sell Stock III</a></li>
<li><a href="https://keshiim.github.io/2017/11/24/Leetcode-122-Best-Time-to-Buy-and-Sell-Stock-II/">Best Time to Buy and Sell Stock II</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://keshiim.github.io/2017/11/24/Leetcode-123-Best-Time-to-Buy-and-Sell-Stock-III/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng keshiim">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Farmer, keshiim 播种太阳🌞">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/24/Leetcode-123-Best-Time-to-Buy-and-Sell-Stock-III/" itemprop="url">Leetcode-123 Best Time to Buy and Sell Stock III</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-24T14:06:46+08:00">
                2017-11-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index">
                    <span itemprop="name">LeetCode</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/24/Leetcode-123-Best-Time-to-Buy-and-Sell-Stock-III/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/24/Leetcode-123-Best-Time-to-Buy-and-Sell-Stock-III/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/11/24/Leetcode-123-Best-Time-to-Buy-and-Sell-Stock-III/" class="leancloud_visitors" data-flag-title="Leetcode-123 Best Time to Buy and Sell Stock III">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iii/description/" target="_blank" rel="external">Best Time to Buy and Sell Stock III 买股票的最佳时间之三</a></p>
<h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>Say you have an array for which the $i^{th}$ element is the price of a given stock on day i.</p>
<p>Design an algorithm to find the maximum profit. You may complete at most <em>two Transactions</em>.</p>
<h3 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h3><p>You may not engage in multiple transactions at the same time(ie, you must sell the stock before you buy again).</p>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>这道题是买股票的最佳时间系列问题中最难最复杂的一道，前面两道<a href="https://keshiim.github.io/2017/11/24/Leetcode-122-Best-Time-to-Buy-and-Sell-Stock-II/">Best Time to Buy and Sell Stock II</a><br>和 <a href="https://keshiim.github.io/2017/11/24/Leetcode-121-Best-Time-to-Buy-and-Sell-Stock/">Best Time to Buy and Sell Stock</a>的思路都非常的简明，算法也很简单。</p>
<p>而这道题是要求最多交易两次，找到最大利润，还是需要用动态规划（Dynamic Programming）来解。</p>
<h3 id="解法一"><a href="#解法一" class="headerlink" title="解法一"></a>解法一</h3><p>这里我们需要两个地推公式来分别更新两个变量local和global，我们其实可以求至少<code>k</code>次交易的最大利润，找到通项公式后可以设定<code>k = 2</code>，即为本题的解答。我们定义<code>local[i][j]</code>为在到达第<code>i</code>天时最多可进行<code>j</code>次交易并且最后一次交易在最后一天卖出的最大利润，此为局部最优。然后我们定义<code>global[i][j]</code>为在到达第<code>i</code>天时最多可进行<code>j</code>次交易的最大利润，为此全局最优。他们的递推公式为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">local[i][j] = max(global[i - <span class="number">1</span>][j - <span class="number">1</span>] + max(diff, <span class="number">0</span>), local[i - <span class="number">1</span>)[j] + diff);</div><div class="line">global[i][j] = max(local[i][j], global[i - <span class="number">1</span>][j])</div></pre></td></tr></table></figure>
<p>其中局部最优值是比较前一天并少交易一次的全局最优加上大于<code>0</code>的差值，和前一天的局部最优加上差值中取较大值，而全局最优值是比较局部最优和前一天的全局最优取较大值。</p>
<p>全局:<br><strong>到达第i天进行j次交易的最大收益 = max{局部（在第i天交易后，恰好满足j次交易），全局（到达第i-1天时已经满足j次交易）}</strong></p>
<p>局部：<br><strong>在第i天交易后，总共交易了j次 =  max{情况2，情况1}<br>情况1：在第i-1天时，恰好已经交易了j次（local[i-1][j]），那么如果i-1天到i天再交易一次：即在第i-1天买入，第i天卖出（diff），则这不并不会增加交易次数！【例如我在第一天买入，第二天卖出；然后第二天又买入，第三天再卖出的行为  和   第一天买入，第三天卖出  的效果是一样的，其实只进行了一次交易！因为有连续性】<br>情况2：第i-1天后，共交易了j-1次（global[i-1][j-1]），因此为了满足“第i天过后共进行了j次交易，且第i天必须进行交易”的条件：我们可以选择：在第i-1天买入，然后再第i天卖出（diff），或者选择在第i天买入，然后同样在第i天卖出（收益为0）。</strong></p>
<p>代码如下：</p>
<h4 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;prices)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (prices.empty()) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> n = prices.size(), g[n][<span class="number">3</span>] = &#123;<span class="number">0</span>&#125;, l[n][<span class="number">3</span>] = &#123;<span class="number">0</span>&#125;;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; prices.size(); i++) &#123;</div><div class="line">            <span class="keyword">int</span> diff = prices[i] - prices[i - <span class="number">1</span>];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= <span class="number">2</span>; j++) &#123;</div><div class="line">                l[i][j] = max(g[i - <span class="number">1</span>][j - <span class="number">1</span>] + max(diff, <span class="number">0</span>), l[i - <span class="number">1</span>][j] + diff);</div><div class="line">                g[i][j] = max(l[i][j], g[i - <span class="number">1</span>][j]);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> g[n - <span class="number">1</span>][<span class="number">2</span>];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Swift"><a href="#Swift" class="headerlink" title="Swift"></a>Swift</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">maxProfit</span><span class="params">(<span class="number">_</span> prices: [Int])</span></span> -&gt; <span class="type">Int</span> &#123;</div><div class="line">        <span class="keyword">if</span> prices.<span class="built_in">count</span> == <span class="number">0</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">let</span> n = prices.<span class="built_in">count</span></div><div class="line">        <span class="keyword">var</span> g = [[<span class="type">Int</span>]](repeating: [<span class="type">Int</span>](repeatElement(<span class="number">0</span>, <span class="built_in">count</span>: <span class="number">3</span>)), <span class="built_in">count</span>: n)</div><div class="line">        <span class="keyword">var</span> l = [[<span class="type">Int</span>]](repeating: [<span class="type">Int</span>](repeatElement(<span class="number">0</span>, <span class="built_in">count</span>: <span class="number">3</span>)), <span class="built_in">count</span>: n)</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span>..&lt;n &#123;</div><div class="line">            <span class="keyword">let</span> diff = prices[i] - prices[i - <span class="number">1</span>]</div><div class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="number">1</span>...<span class="number">2</span> &#123;</div><div class="line">                l[i][j] = <span class="built_in">max</span>(g[i - <span class="number">1</span>][j - <span class="number">1</span>] + <span class="built_in">max</span>(diff, <span class="number">0</span>), l[i - <span class="number">1</span>][j] + diff)</div><div class="line">                g[i][j] = <span class="built_in">max</span>(l[i][j], g[i - <span class="number">1</span>][j])</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> g[n - <span class="number">1</span>][<span class="number">2</span>]</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="提升"><a href="#提升" class="headerlink" title="提升"></a>提升</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*节省空间版本：</span></div><div class="line"><span class="comment">下面这种解法用一维数组来代替二维数组，</span></div><div class="line"><span class="comment">可以极大的节省了空间，由于覆盖的顺序关</span></div><div class="line"><span class="comment">系，我们需要j从2到1，这样可以取到正确</span></div><div class="line"><span class="comment">的g[j-1]值，而非已经被覆盖过的值，参见代码如下：</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;prices)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (prices.empty()) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> g[<span class="number">3</span>] = &#123;<span class="number">0</span>&#125;;</div><div class="line">        <span class="keyword">int</span> l[<span class="number">3</span>] = &#123;<span class="number">0</span>&#125;;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; prices.size() - <span class="number">1</span>; ++i) &#123;</div><div class="line">            <span class="keyword">int</span> diff = prices[i + <span class="number">1</span>] - prices[i];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">2</span>; j &gt;= <span class="number">1</span>; --j) &#123;</div><div class="line">                l[j] = max(g[j - <span class="number">1</span>] + max(diff, <span class="number">0</span>), l[j] + diff);</div><div class="line">                g[j] = max(l[j], g[j]);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> g[<span class="number">2</span>];</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="解法二"><a href="#解法二" class="headerlink" title="解法二"></a>解法二</h3><p>也是用DP，设置四个变量，<code>buy1、buy2、sell1、sell2</code>分别记录第一次购买，第二次购买和第一次卖出，第二次卖出。<br>因为题目要求只能在这个循序下<code>（buy1 —&gt; sell1 -&gt; buy2 -&gt; sell2）</code>完成交易。所以遍历一遍数组，每一次买入的时候尽可能花钱代价最小，每次卖出时尽可能高价卖出，代码如下。</p>
<h4 id="C-1"><a href="#C-1" class="headerlink" title="C++"></a>C++</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; prices)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> buy1 = INT_MIN, buy2 = INT_MIN;</div><div class="line">        <span class="keyword">int</span> sell1 = <span class="number">0</span>, sell2 = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> price: prices) &#123;</div><div class="line">            sell2 = max(sell2, buy2 + price);</div><div class="line">            buy2 = max(buy2, sell1 - price);</div><div class="line">            sell1 = max(sell1, buy1 + price);</div><div class="line">            buy1 = max(buy1, -price);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> sell2;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="Swift-1"><a href="#Swift-1" class="headerlink" title="Swift"></a>Swift</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">maxProfit</span><span class="params">(<span class="number">_</span> prices: [Int])</span></span> -&gt; <span class="type">Int</span> &#123;</div><div class="line">        <span class="keyword">if</span> prices.<span class="built_in">count</span> == <span class="number">0</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">var</span> buy1 = <span class="type">Int</span>.<span class="built_in">min</span>, buy2 = <span class="type">Int</span>.<span class="built_in">min</span></div><div class="line">        <span class="keyword">var</span>  sell1 = <span class="number">0</span>, sell2 = <span class="number">0</span></div><div class="line">        <span class="keyword">for</span> price <span class="keyword">in</span> prices &#123;</div><div class="line">            sell2 = <span class="built_in">max</span>(sell2, buy2 + price)</div><div class="line">            buy2  = <span class="built_in">max</span>(buy2, sell1 - price)</div><div class="line">            sell1 = <span class="built_in">max</span>(sell1, buy1 + price)</div><div class="line">            buy1  = <span class="built_in">max</span>(buy1, -price)</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> sell2;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="http://blog.csdn.net/fightforyourdream/article/details/14503469" target="_blank" rel="external">http://blog.csdn.net/fightforyourdream/article/details/14503469</a></p>
<h3 id="相关题目"><a href="#相关题目" class="headerlink" title="相关题目"></a>相关题目</h3><ul>
<li><a href="https://keshiim.github.io/2017/11/24/Leetcode-309-Best-Time-to-Buy-and-Sell-Stock-with-Cooldown/">Best Time to Buy and Sell Stock with Cooldown</a></li>
<li><a href="https://keshiim.github.io/2017/11/24/Leetcode-188-Best-Time-to-Buy-and-Sell-Stock-IV/">Best Time to Buy and Sell Stock IV</a></li>
<li><a href="https://keshiim.github.io/2017/11/24/Leetcode-122-Best-Time-to-Buy-and-Sell-Stock-II/">Best Time to Buy and Sell Stock II</a></li>
<li><a href="https://keshiim.github.io/2017/11/24/Leetcode-121-Best-Time-to-Buy-and-Sell-Stock/">Best Time to Buy and Sell Stock</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://keshiim.github.io/2017/11/24/Leetcode-122-Best-Time-to-Buy-and-Sell-Stock-II/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng keshiim">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Farmer, keshiim 播种太阳🌞">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/24/Leetcode-122-Best-Time-to-Buy-and-Sell-Stock-II/" itemprop="url">Leetcode-122 Best Time to Buy and Sell Stock II</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-24T11:32:51+08:00">
                2017-11-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index">
                    <span itemprop="name">LeetCode</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/24/Leetcode-122-Best-Time-to-Buy-and-Sell-Stock-II/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/24/Leetcode-122-Best-Time-to-Buy-and-Sell-Stock-II/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/11/24/Leetcode-122-Best-Time-to-Buy-and-Sell-Stock-II/" class="leancloud_visitors" data-flag-title="Leetcode-122 Best Time to Buy and Sell Stock II">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock-ii/description/" target="_blank" rel="external">Best Time to Buy and Sell Stock II 买股票的最佳时间之二</a></p>
<h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>Say you have an array for which the $i^{th}$  element is the price of a given stock on day i.</p>
<p>Design an algorithm to find the maximum profit. You may complete as many transaction as you like(ie, buy one and sell one share of the stock multiple times). However, you may not engage in multiple transactions at the same time(ie, you must sell the stock before you buy again).</p>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><pre><code>input [3, 2, 3, 5, 3, 6]
output 6
不是 6-2=4
而是(3-2)+(5-3)+(6-3)=6
</code></pre><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>这道题跟之前<a href="https://keshiim.github.io/2017/11/24/Leetcode-121-Best-Time-to-Buy-and-Sell-Stock/">Best Time to Buy and Sell Stock</a>类似，这道题由于可以无限次数的买入和卖出，并且要求每次买入之前，必须先卖掉上次买入的股票。要想利润最大化当然是低价买入高价抛出。</p>
<h3 id="解法"><a href="#解法" class="headerlink" title="解法"></a>解法</h3><p>这里我们只需要从第二天开始，如果当天价格比之前价格高，则把插值加入利润中，因为我们可以昨天买入，今天卖出，若明日价格更高的话，可以今日买入，明日卖出。一次类推，遍历整个数组后即可求得最大利润。代码如下：</p>
<h4 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; prices)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> res = <span class="number">0</span>, n = prices.size();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n - <span class="number">1</span>; i++) &#123;</div><div class="line">            <span class="keyword">if</span> (prices[i] &lt; prices[i + <span class="number">1</span>]) &#123;</div><div class="line">                res += prices[i + <span class="number">1</span>] - prices[i];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> res;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="keyword">int</span>[] prices)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> maxprofit = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; prices.length; i++) &#123;</div><div class="line">            <span class="keyword">if</span> (prices[i] &gt; prices[i - <span class="number">1</span>])</div><div class="line">                maxprofit += prices[i] - prices[i - <span class="number">1</span>];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> maxprofit;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Swift"><a href="#Swift" class="headerlink" title="Swift"></a>Swift</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">maxProfit</span><span class="params">(<span class="number">_</span> prices: [Int])</span></span> -&gt; <span class="type">Int</span> &#123;</div><div class="line">        <span class="keyword">var</span> res = <span class="number">0</span>, i = <span class="number">0</span></div><div class="line">        <span class="keyword">let</span> n = prices.<span class="built_in">count</span></div><div class="line">        <span class="keyword">while</span> i &lt; n - <span class="number">1</span> &#123;</div><div class="line">            <span class="keyword">if</span> prices[i] &lt; prices[i + <span class="number">1</span>] &#123;</div><div class="line">               res += prices[i + <span class="number">1</span>] - prices[i]</div><div class="line">            &#125;</div><div class="line">            i += <span class="number">1</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> res</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="相关题目："><a href="#相关题目：" class="headerlink" title="相关题目："></a>相关题目：</h3><ul>
<li><a href="https://keshiim.github.io/2017/11/24/Leetcode-309-Best-Time-to-Buy-and-Sell-Stock-with-Cooldown/">Best Time to Buy and Sell Stock with Cooldown</a></li>
<li><a href="https://keshiim.github.io/2017/11/24/Leetcode-188-Best-Time-to-Buy-and-Sell-Stock-IV/">Best Time to Buy and Sell Stock IV</a></li>
<li><a href="https://keshiim.github.io/2017/11/24/Leetcode-123-Best-Time-to-Buy-and-Sell-Stock-III/">Best Time to Buy and Sell Stock III</a></li>
<li><a href="https://keshiim.github.io/2017/11/24/Leetcode-121-Best-Time-to-Buy-and-Sell-Stock/">Best Time to Buy and Sell Stock</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://keshiim.github.io/2017/11/24/Leetcode-121-Best-Time-to-Buy-and-Sell-Stock/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng keshiim">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Farmer, keshiim 播种太阳🌞">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/24/Leetcode-121-Best-Time-to-Buy-and-Sell-Stock/" itemprop="url">Leetcode-121 Best Time to Buy and Sell Stock</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-24T10:49:42+08:00">
                2017-11-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index">
                    <span itemprop="name">LeetCode</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/24/Leetcode-121-Best-Time-to-Buy-and-Sell-Stock/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/24/Leetcode-121-Best-Time-to-Buy-and-Sell-Stock/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/11/24/Leetcode-121-Best-Time-to-Buy-and-Sell-Stock/" class="leancloud_visitors" data-flag-title="Leetcode-121 Best Time to Buy and Sell Stock">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock/description/" target="_blank" rel="external">Best Time to Buy and Sell Stock 最佳倒卖股票</a></p>
<h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>Say you have an array for which the $i^{th}$  element is the price of a given stock on day i.</p>
<p>If you were only permitted to complete at most one transaction(ie, buy one and sell one share of the stock), design an algorithm to find the maximum profit.</p>
<h3 id="Example-1"><a href="#Example-1" class="headerlink" title="Example 1"></a>Example 1</h3><pre><code>Input: [7, 1, 5, 3, 6, 4]
Output: 5

max. difference = 6-1 = 5 (not 7-1 = 6, as selling price needs to be larger than buying price)
</code></pre><h3 id="Example-2"><a href="#Example-2" class="headerlink" title="Example 2"></a>Example 2</h3><pre><code>Input: [7, 6, 4, 3, 1]
Output: 0

In this case, no transaction is done, i.e. max profit = 0.
</code></pre><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>假如说给了一个数组，每一个元素都当天股票交易的价格。<br>现在，如果只允许你完成至多一次交易(也就是，买入一次股票，卖出一次股票)，设计一个可以利润最大化的算法。</p>
<h3 id="解法"><a href="#解法" class="headerlink" title="解法"></a>解法</h3><p>只需要遍历一遍数组，用一个变量记录遍历过程中的最小值，然后每次计算当前值和这个最小值之间的差值最利润，然后每次选较大利润来更新。当遍历完成后当前利润就是最大利润。代码如下：</p>
<h3 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; prices)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> res = <span class="number">0</span>, buy = INT_MAX;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> price: prices) &#123;</div><div class="line">            buy = min(buy, price);</div><div class="line">            res = max(res, price - buy);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> res;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="Swift"><a href="#Swift" class="headerlink" title="Swift"></a>Swift</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">maxProfit</span><span class="params">(<span class="number">_</span> prices: [Int])</span></span> -&gt; <span class="type">Int</span> &#123;</div><div class="line">        <span class="keyword">var</span> res = <span class="number">0</span>, buy = <span class="type">Int</span>.<span class="built_in">max</span></div><div class="line">        <span class="keyword">for</span> price <span class="keyword">in</span> prices &#123;</div><div class="line">            buy = <span class="built_in">min</span>(buy, price)</div><div class="line">            res = <span class="built_in">max</span>(res, price - buy)</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> res</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="keyword">int</span>[] prices)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> res = <span class="number">0</span>, buy = Integer.MAX_VALUE;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> price : prices) &#123;</div><div class="line">            buy = Math.min(buy, price);</div><div class="line">            res = Math.max(res, price - buy);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> res;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="相关题目"><a href="#相关题目" class="headerlink" title="相关题目"></a>相关题目</h3><ul>
<li><a href="https://keshiim.github.io/2017/11/24/Leetcode-309-Best-Time-to-Buy-and-Sell-Stock-with-Cooldown/">Best Time to Buy and Sell Stock with Cooldown</a></li>
<li><a href="https://keshiim.github.io/2017/11/24/Leetcode-188-Best-Time-to-Buy-and-Sell-Stock-IV/">Best Time to Buy and Sell Stock IV</a></li>
<li><a href="https://keshiim.github.io/2017/11/24/Leetcode-123-Best-Time-to-Buy-and-Sell-Stock-III/">Best Time to Buy and Sell Stock III</a></li>
<li><a href="https://keshiim.github.io/2017/11/24/Leetcode-122-Best-Time-to-Buy-and-Sell-Stock-II/">Best Time to Buy and Sell Stock II</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://keshiim.github.io/2017/11/23/swift-inherit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng keshiim">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Farmer, keshiim 播种太阳🌞">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/23/swift-inherit/" itemprop="url">Swift：继承</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-23T18:12:14+08:00">
                2017-11-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/23/swift-inherit/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/23/swift-inherit/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/11/23/swift-inherit/" class="leancloud_visitors" data-flag-title="Swift：继承">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一个类可以从另一个类继承方法、属性和其他的特性。当一个类从另一个类继承的时候，继承的类就是所谓的子类，而这个类继承的类被称为父类。在 Swift 中，继承与其他类型不同的基础分类行为。</p>
<p>在 Swift 中类可以调用和访问属于它们父类的方法、属性和下标脚本，并且可以提供它们自己重写的方法，属性和下标脚本来定义或修改它们的行为。Swift <em>会通过检查重写定义都有一个与之匹配的父类定义来确保你的重写是正确的</em>。</p>
<p><em>类也可以向继承的属性添加属性观察器，以便在属性的值改变时得到通知。可以添加任何属性监视到属性中，不管它是被定义为存储还是计算属性。</em></p>
<h3 id="定义一个基类"><a href="#定义一个基类" class="headerlink" title="定义一个基类"></a>定义一个基类</h3><p><strong>任何不从另一个类继承的类</strong>都是所谓的<strong>基类</strong>。</p>
<blockquote>
<p>注意：<br>Swift 类不会从一个通用基类继承。你没有指定特定父类的类都会以基类的形式创建。</p>
</blockquote>
<p>下面的栗子定义了一个叫做 <code>Vehicle</code> 的基类。这个基类定义了一个称为 <code>currentSpeed</code> 的存储属性，使用默认值 0.0 (推断为一个 <code>Double</code> 类型的属性)。 <code>currentSpeed</code> 属性的值被用在一个称为 <code>description</code> 的 <code>String</code> <em>只读计算属性</em>来创建一个 <code>vehicle</code> 的描述。</p>
<p><code>Vehicle</code> 基类也定义了一个称为 <code>makeNoise</code> 的方法。这个方法实际上不会为这个 <code>Vehicle</code> 基类的实例做任何事，但是稍后它可以被 <code>Vehicle</code> 的子类自定义：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vehicle</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> currentSpeed = <span class="number">0.0</span></div><div class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"traveling at <span class="subst">\(currentSpeed)</span> miles per hour"</span></div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeNoise</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="comment">// do nothing - an arbitrary vehicle doesn't necessarily make a noise</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>你使用初始化语法创建了一个新的 Vehicle 实例，写为 类型名 后面跟着一个空括号：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> someVehicle = <span class="type">Vehicle</span>()</div></pre></td></tr></table></figure>
<p>在创建了一个新的 <code>Vehicle</code> 实例之后，你可以访问它的 <code>description</code> 属性来输出一个人类可读的汽车当前速度的描述：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">print</span>(<span class="string">"Vehicle: <span class="subst">\(someVehicle.description)</span>"</span>)</div><div class="line"><span class="comment">// Vehicle: traveling at 0.0 miles per hour</span></div></pre></td></tr></table></figure>
<p><code>Vehicle</code> 类为任意的车辆定义了共同的特征，但是对它本身没有太大用处。为了让它更有用，你需要重定义它来描述更具体的车辆种类。</p>
<h3 id="子类"><a href="#子类" class="headerlink" title="子类"></a>子类</h3><p><strong>子类是基于现有类创建新类的行为</strong>。子类从现有的类继承了一些特征，你可以重新定义它们。你也可以为子类添加新的特征。</p>
<p>为了表明子类有父类，要把子类写在父类的前面，用冒号分隔：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeSubclass</span>: <span class="title">SomeSuperclass</span> </span>&#123;</div><div class="line">    <span class="comment">// subclass definition goes here</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>下面的例子定义了一个称为 <code>Bicycle</code> 的子类，继承自 <code>Vehicle</code> ：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bicycle</span>: <span class="title">Vehicle</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> hasBasket = <span class="literal">false</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>新的 <code>Bicycle</code> 类自动获得了 <code>Vehicle</code> 的所有特征，例如它的 <code>currentSpeed</code> 和 <code>description</code> 属性以及 <code>makeNoise()</code> 方法。</p>
<p>除了继承的特征， <code>Bicycle</code> 类定义了一个新的存储属性 <code>hasBasket</code> ，并且默认值为 <code>false</code> (属性的类型被推断为 <code>Bool</code> )。</p>
<p>默认情况下，任何你新建的 <code>Bicycle</code> 实例都都不会有篮子。在 <code>Bicycle</code> 类的实例创建之后，你可以将它的 <code>hasBasket</code> 属性设置为 <code>true</code> ：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> bicycle = <span class="type">Bicycle</span>()</div><div class="line">bicycle.hasBasket = <span class="literal">true</span></div></pre></td></tr></table></figure>
<p>你也可以在 <code>Bicycle</code> 类实例中修改继承而来的 <code>currentSpeed</code> 属性，或是查询实例中继承的 <code>description</code> 属性：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">bicycle.currentSpeed = <span class="number">15.0</span></div><div class="line"><span class="built_in">print</span>(<span class="string">"Bicycle: <span class="subst">\(bicycle.description)</span>"</span>)</div><div class="line"><span class="comment">// Bicycle: traveling at 15.0 miles per hour</span></div></pre></td></tr></table></figure>
<p><strong>子类本身也可以被继承</strong>。下个栗子创建了一个 <code>Bicycle</code> 的子类，称为”tandem”的两座自行车：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tandem</span>: <span class="title">Bicycle</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> currentNumberOfPassengers = <span class="number">0</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>Tandem</code> 继承了 <code>Bicycle</code> 中所有的属性和方法，也继承了 <code>Vehicle</code> 的所有属性和方法。 <code>Tandem</code> 子类也添加了一个新的称为 <code>currentNumberOfPassengers</code> 的存储属性，并且有一个默认值 0 ：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> tandem = <span class="type">Tandem</span>()</div><div class="line">tandem.hasBasket = <span class="literal">true</span></div><div class="line">tandem.currentNumberOfPassengers = <span class="number">2</span></div><div class="line">tandem.currentSpeed = <span class="number">22.0</span></div><div class="line"><span class="built_in">print</span>(<span class="string">"Tandem: <span class="subst">\(tandem.description)</span>"</span>)</div><div class="line"><span class="comment">//Print: Tandem: traveling at 22.0 mils per hour</span></div></pre></td></tr></table></figure>
<h3 id="重写"><a href="#重写" class="headerlink" title="重写"></a>重写</h3><p>子类可以提供它自己的实例方法、类型方法、实例属性，类型属性或下标脚本的自定义实现，否则它将会从父类继承。这就所谓的<strong>重写</strong>。</p>
<p>要重写而不是继承一个特征，你需要在你的重写定义前面加上 <code>override</code> 关键字。这样做说明你打算提供一个重写而不是意外提供了一个相同定义。意外的重写可能导致意想不到的行为，并且<em>任何没有使用</em>  <code>override</code> 关键字的重写都会在编译时被诊断为错误。</p>
<p><code>override</code> 关键字会执行 Swift 编译器检查你重写的类的父类(或者父类的父类)是否有与之匹配的声明来供你重写。这个检查确保你重写的定义是正确的。</p>
<h4 id="访问父类的方法、属性和下标脚本"><a href="#访问父类的方法、属性和下标脚本" class="headerlink" title="访问父类的方法、属性和下标脚本"></a>访问父类的方法、属性和下标脚本</h4><p>当你为子类提供了一个方法、属性或者下标脚本时，有时<strong>使用现有的父类实现作为你重写的一部分是很有用的</strong>。比如说，你可以重新定义现有实现的行为，或者在现有继承的变量中存储一个修改过的值。</p>
<p>你可以通过使用 <code>super</code> 前缀访问父类的方法、属性或下标脚本，这是合适的：</p>
<ul>
<li>一个命名为 <code>someMethod()</code> 的重写方法可以通过 <code>super.someMethod()</code> 在重写方法的实现中调用父类版本的 <code>someMethod()</code> 方法；</li>
<li>一个命名为 <code>someProperty</code> 的重写属性可以通过 <code>super.someProperty</code> 在重写的 <code>getter</code> 或 <code>setter</code> 实现中访问父类版本的 <code>someProperty</code> 属性；</li>
<li>一个命名为 <code>someIndex</code> 的重写下标脚本可以使用 <code>super[someIndex]</code> 在重写的下标脚本实现中访问父类版本中相同的下标脚本。</li>
</ul>
<h4 id="重写方法"><a href="#重写方法" class="headerlink" title="重写方法"></a>重写方法</h4><p>你可以在你的子类中重写一个继承的实例或类型方法来提供定制的或替代的方法实现。</p>
<p>下面的栗子定义了一个新的 <code>Vehicle</code> 子类，称为 <code>Train</code> ，它重写了 <code>Train</code> 继承自 <code>Vehicle</code> 的 <code>makeNoise()</code> 方法：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Train</span>: <span class="title">Vehicle</span> </span>&#123;</div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">makeNoise</span><span class="params">()</span></span> &#123;</div><div class="line">         <span class="built_in">print</span>(<span class="string">"Choo Choo"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果你创建了一个新的 <code>Train</code> 实例并且调用它的 <code>makeNoise()</code> 方法，你可以看到 <code>Train</code> 子类版本的方法被调用了：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> train = <span class="type">Train</span>()</div><div class="line">train.makeNoise()</div><div class="line"><span class="comment">// prints "Choo Choo"</span></div></pre></td></tr></table></figure>
<h4 id="重写属性"><a href="#重写属性" class="headerlink" title="重写属性"></a>重写属性</h4><p>你可以重写一个继承的实例或类型属性来为你自己的属性提供你自己自定义的 <code>getter</code> 和 <code>setter</code> ，或者<strong>添加属性观察器</strong>确保当底层属性值改变时来监听重写的属性。</p>
<h5 id="重写属性的GETTER和SETTER"><a href="#重写属性的GETTER和SETTER" class="headerlink" title="重写属性的GETTER和SETTER"></a>重写属性的GETTER和SETTER</h5><p>你可以提供<strong>一个自定义的</strong> <code>Getter</code>(和<code>Setter</code>，如果合适的话)<strong>来重写任意继承的属性</strong>，无论在最开始继承的属性实现为储属性还是计算属性。<strong>继承的属性是存储还是计算属性不对子类透明</strong>——它仅仅知道继承的属性有个特定名字和类型。你必须声明你重写的属性名字和类型，以确保编译器可以检查你的重写是否匹配了父类中有相同名字和类型的属性。</p>
<p><em>你可以通过在你的子类重写里为继承而来的只读属性添加Getter和Setter来把它用作可读写属性。总之，你不能把一个继承而来的可读写属性表示为只读属性。</em></p>
<blockquote>
<p>注意：<br>如果你提供了一个<code>setter</code>作为属性重写的一部分，<em>你也就必须为重写提供一个</em> <code>getter</code>。如果你不想在重写<code>getter</code>时修改继承属性的值，那么你可以简单通过从<code>getter</code>返回 <code>super.someProperty</code> 来传递继承的值， <code>someProperty</code> 就是你重写的那个属性的名字。</p>
</blockquote>
<p>下面的栗子定义了一个叫做 <code>Car</code> 的新类，它是 <code>Vehicle</code> 的子类。 <code>Car</code> 类引入了一个新的存储属性<code>gear</code>，并且有一个默认的整数值 1 。 <code>Car</code> 类也重写了继承自 <code>Vehicle</code> 的 <code>description</code> 属性，来提供自定义的描述，介绍当前的档位：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span>: <span class="title">Vehicle</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> gear = <span class="number">1</span></div><div class="line">    <span class="keyword">override</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.description + <span class="string">" in gear <span class="subst">\(gear)</span>"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>description</code> 属性的重写以调用 <code>super.description</code> 开始，它返回了 <code>Vehicle</code> 类的 <code>description</code> 属性。 <code>Car</code> 类的 <code>description</code> 随后就添加了一些额外的文本到描述的末尾以提供关于当前档位的信息。</p>
<p>如果你创建一个 <code>Car</code> 类的实例并且设置它的 <code>gear</code> 和 <code>currentSpeed</code> 属性，你就可以看到它的 <code>description</code> 属性在 <code>Car</code> 类的定义里返回了定制的描述：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> car = <span class="type">Car</span>()</div><div class="line">car.currentSpeed = <span class="number">25.0</span></div><div class="line">car.gear = <span class="number">3</span></div><div class="line"><span class="built_in">print</span>(<span class="string">"Car: <span class="subst">\(car.description)</span>"</span>)</div><div class="line"><span class="comment">// Car: traveling at 25.0 miles per hour in gear 3</span></div></pre></td></tr></table></figure>
<h4 id="重写属性观察器"><a href="#重写属性观察器" class="headerlink" title="重写属性观察器"></a>重写属性观察器</h4><p>你可以使用属性重写来为继承的属性添加属性观察器。这就可以让你在继承属性的值改变时得到通知，无论这个属性最初如何实现。</p>
<blockquote>
<p>注意<br>你不能给继承而来的<strong>常量存储属性或者只读的计算属性添加属性观察器</strong>。这些属性的值不能被设置，所以提供 <code>willSet</code> 或 <code>didSet</code> 实现作为重写的一部分也是不合适的。</p>
<p>也要注意你<strong>不能为同一个属性同时提供重写的<code>setter</code>和重写的属性观察器</strong>。如果你想要监听属性值的改变，并且你已经为那个属性提供了一个自定义的<code>setter</code>，那么你从自定义的<code>setter</code>里就可以监听任意值的改变。</p>
</blockquote>
<p>下面的例子定义了一个叫做 <code>AutomaticCar</code> 的新类，它是 <code>Car</code> 的子类。 <code>AutomaticCar</code> 类代表一辆车有一个自动的变速箱，可以<em>根据当前的速度自动地选择一个合适的档位</em>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AutomaticCar</span>: <span class="title">Car</span> </span>&#123;</div><div class="line">    <span class="keyword">override</span> <span class="keyword">var</span> currentSpeed: <span class="type">Double</span> &#123;</div><div class="line">        <span class="keyword">didSet</span> &#123;</div><div class="line">            <span class="keyword">self</span>.gear = <span class="type">Int</span>(currentSpeed / <span class="number">10.0</span>) + <span class="number">1</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>无论你在什么时候设置了 <code>AutomaticCar</code> 实例的 <code>currentSpeed</code> 属性，属性的 <code>didSet</code> 观察器都会设置实例的 <code>gear</code> 属性为新速度设置一个合适的档位。具体地说，属性观察器选择的档位就是新的 <code>currentSpeed</code> 值除以 10 ，四舍五入到最近整数，加 1 。速度是 35.0 就对应 4 ：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> automatic = <span class="type">AutomaticCar</span>()</div><div class="line">automatic.currentSpeed = <span class="number">35.0</span></div><div class="line"><span class="built_in">print</span>(<span class="string">"AutomaticCar: <span class="subst">\(automatic.description)</span>"</span>)</div><div class="line"><span class="comment">// AutomaticCar: traveling at 35.0 miles per hour in gear 4</span></div></pre></td></tr></table></figure>
<h3 id="阻止重写"><a href="#阻止重写" class="headerlink" title="阻止重写"></a>阻止重写</h3><p>你可以通过<strong>标记为终点来阻止一个方法、属性或者下标脚本被重写</strong>。通过在方法、属性或者下标脚本的关键字前写 <code>final</code> 修饰符<code>(比如 final var ， final func ， final class func ， fianl subscript )</code>。</p>
<p>任何在子类里重写<em>终点方法、属性或下标脚本</em>的尝试都会被报告为编译时错误。你在扩展中添加到类的方法、属性或下标脚本也<strong>可以在扩展的定义里被标记为终点</strong>。</p>
<p><strong>你可以通过在类定义中</strong>在 <code>class</code> 关键字前面写 <code>final</code> 修饰符( <code>final class</code> )标记<strong>一整个类为终点</strong>。任何想要从终点类创建子类的行为都会被报告一个编译时错误。</p>
<blockquote>
<p>摘自：<a href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/Swift_Programming_Language/index.html#//apple_ref/doc/uid/TP40014097-CH3-ID0" target="_blank" rel="external">swift 官网</a><br>所有代码在Xcode9 Swift4 环境编译没问题，代码<a href="https://github.com/keshiim/LearnSwift4" target="_blank" rel="external">戳这里 https://github.com/keshiim/LearnSwift4</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://keshiim.github.io/2017/11/23/swift-subscript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng keshiim">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Farmer, keshiim 播种太阳🌞">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/23/swift-subscript/" itemprop="url">Swift：下标</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-23T17:01:43+08:00">
                2017-11-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习/" itemprop="url" rel="index">
                    <span itemprop="name">学习</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/23/swift-subscript/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/23/swift-subscript/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/11/23/swift-subscript/" class="leancloud_visitors" data-flag-title="Swift：下标">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><em>类、结构体</em>和<em>枚举</em>可以定义下标，它可以作为访问集合、列表或序列成员元素的快捷方式。你可使用下标，通过<strong>索引值</strong>来<em>设置</em>或<em>检索值</em>而不需要为设置和检索分别使用实例方法。比如说，用 <code>someArray[index]</code> 来访问 <code>Array</code> 实例中的元素以及用 <code>someDictionary[key]</code> 访问 <code>Dictionary</code> 实例中的元素。</p>
<p>你可以为一个类型<strong>定义多个下标</strong>，并且下标会基于传入的索引值的类型选择合适的下标<strong>重载使用</strong>。下标<em>没有限制单个维度</em>，你可以使用多个输入形参来定义下标以满足自定义类型的需求。</p>
<h3 id="下标的语法"><a href="#下标的语法" class="headerlink" title="下标的语法"></a>下标的语法</h3><p>下表脚本允许你通过在实例名后面的方括号内<em>写一个或多个值</em>对该类的实例进行查询。它的语法类似于<em>实例方法和和计算属性</em>。使用关键字 <code>subscript</code> 来定义下标，并且指定一个或多个输入形式参数和返回类型，与实例方法一样。与实例方法不同的是，下标可以是读写也可以是只读的。这个行为通过与计算属性中相同的 <code>getter</code> 和 <code>setter</code> 传达：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">subscript</span>(index: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</div><div class="line">    <span class="keyword">get</span> &#123;</div><div class="line">        <span class="comment">// return an appropriate subscript value here</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">set</span>(newValue) &#123;</div><div class="line">        <span class="comment">// perform a suitable setting action here</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>newValue</code> 的类型和下标的返回值一样。与计算属性一样，你可以选择不去指定 <code>setter</code> 的( <code>newValue</code> )形式参数。 <code>setter</code> 默认提供形式参数 <code>newValue</code> ，如果你自己没有提供的话。</p>
<p><em>与只读计算属性一样，你可以给只读下标省略 <code>get</code> 关键字：</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">subscript</span>(index: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</div><div class="line">    <span class="comment">// return an appropriate subscript value here</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>下面是一个只读下标实现的栗子，它定义了一个 <code>TimeTable</code> 结构体来表示整数的n倍表：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TimesTable</span> </span>&#123;</div><div class="line">    <span class="keyword">let</span> multiplier: <span class="type">Int</span></div><div class="line">    <span class="keyword">subscript</span>(index: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</div><div class="line">        <span class="keyword">return</span> multiplier * index</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">let</span> threeTimesTable = <span class="type">TimesTable</span>(multiplier: <span class="number">3</span>)</div><div class="line"><span class="built_in">print</span>(<span class="string">"six times three is <span class="subst">\(threeTimesTable[<span class="number">6</span>])</span>"</span>)</div><div class="line"><span class="comment">// prints "six times three is 18"</span></div></pre></td></tr></table></figure>
<p>在这个栗子中，创建了一个 <code>TimeTable</code> 的新实例来表示三倍表。它表示通过给结构体的 <code>initializer</code> 转入值 3 来作为用于实例的 <code>multiplier</code> 形式参数。</p>
<blockquote>
<p>n倍表是基于固定的数学公式。并不适合对 <code>threeTimesTable[someIndex]</code> 进行赋值操作，所以 <code>TimesTable</code> 的下标定义为只读下标</p>
</blockquote>
<h3 id="下标用法"><a href="#下标用法" class="headerlink" title="下标用法"></a>下标用法</h3><p>“下标”确切的意思取决于它使用的上下文。通常下标是用来访问集合、列表或序列中元素的快捷方式。你可以在你自己特定的类或结构体中自由实现下标来提供合适的功能。</p>
<p>例如，Swift 的 <code>Dictionary</code> 类型实现了下标来对 <code>Dictionary</code> 实例中存放的值进行设置和读取操作。你可以在下标的方括号中通过提供字典键类型相同的键来设置字典里的值，并且把一个与字典值类型相同的值赋给这个下标：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> numberOfLegs = [<span class="string">"spider"</span>: <span class="number">8</span>， <span class="string">"ant"</span>: <span class="number">6</span>， <span class="string">"cat"</span>: <span class="number">4</span>]</div><div class="line">numberOfLegs[<span class="string">"bird"</span>] = <span class="number">2</span></div></pre></td></tr></table></figure>
<p>上面的栗子定义了一个名为 <code>numberOfLegs</code> 的变量并用一个字典字面量初始化出了包含三个键值对的字典实例。 <code>numberOfLegs</code> 字典的类型推断为 <code>[String:Int]</code> 。字典实例创之后，这个栗子下标赋值来添加一个 <code>String</code> 键 “<code>bird</code>“ 和 <code>Int</code> 值 2 到字典中。</p>
<blockquote>
<p>Swift 的 Dictionary 类型实现它的下标为接收和返回<em>可选类型</em>的下标。对于上例中的 <code>numberOfLegs</code> 字典，键值下标接收和返回一个 <code>Int?</code> 类型的值，或者说“<em>可选的</em> <code>Int</code>  ”。 Dictionary 类型使用可选的下标类型来建模不是所有键都会有值的事实，并且提供了一种通过给键赋值为 <em>nil</em> 来删除对应键的值的方法。</p>
</blockquote>
<h3 id="下标选项"><a href="#下标选项" class="headerlink" title="下标选项"></a>下标选项</h3><p>下标可以接收任意数量的输入形式参数，并且这些输入形式参数可以是任意类型。下标也可以返回任意类型。下标可以使用<strong>变量形式参数</strong>和<strong>可变形式参数</strong>(Int…)， <em>但是不能使用输入输出形式参数或提供默认形式参数值。</em></p>
<p>类或结构体可以根据自身需要提供多个下标实现，合适被使用的下标会基于值类型或者使用下标时下标方括号里包含的值来推断。这个对多下标的定义就是<strong>所谓的下标重载</strong>。</p>
<p>通常来讲下标接收一个形式参数，但只要你的类型需要也可以为下标定义多个参数。如下例定义了一个 <code>Matrix</code> 结构体，它呈现一个 <code>Double</code> 类型的二维矩阵。 <code>Matrix</code> 结构体的下标接收两个整数形式参数：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Matrix</span> </span>&#123;</div><div class="line">    <span class="keyword">let</span> rows: <span class="type">Int</span>, columns: <span class="type">Int</span></div><div class="line">    <span class="keyword">var</span> grid: [<span class="type">Double</span>]</div><div class="line">    <span class="keyword">init</span>(rows: <span class="type">Int</span>, columns: <span class="type">Int</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.rows = rows</div><div class="line">        <span class="keyword">self</span>.columns = columns</div><div class="line">        grid = [<span class="type">Double</span>](repeatElement(<span class="number">0.0</span>, <span class="built_in">count</span>: rows * columns))</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">indexIsValid</span><span class="params">(row: Int, column: Int)</span></span> -&gt; <span class="type">Bool</span> &#123;</div><div class="line">        <span class="keyword">return</span> row &gt;= <span class="number">0</span> &amp;&amp; row &lt; rows &amp;&amp; column &gt;= <span class="number">0</span> &amp;&amp; column &lt; columns</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">subscript</span>(row: <span class="type">Int</span>, column: <span class="type">Int</span>) -&gt; <span class="type">Double</span> &#123;</div><div class="line">        <span class="keyword">get</span> &#123;</div><div class="line">            <span class="built_in">assert</span>(indexIsValid(row: row, column: column), <span class="string">"Index out of range"</span>)</div><div class="line">            <span class="keyword">return</span> grid[(row * columns) + column]</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">set</span> &#123;</div><div class="line">            <span class="built_in">assert</span>(indexIsValid(row: row, column: column), <span class="string">"Index out of range"</span>)</div><div class="line">            grid[(row * columns) + column] = newValue</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>Matrix</code> 提供了一个接收 <code>rows</code> 和 <code>columns</code> 两个形式参数的初始化器，创建了一个足够容纳<code>rows * columns</code> 个数的 <code>Double</code> 类型数组。矩阵里的每个位置都用 <code>0.0</code> 初始化。要这么做，数组的长度，每一格初始化为 <code>0.0</code> ，都传入数组初始化器来创建和初始化一个正确长度的数组。这个初始化器在使用默认值创建数组里有更详细的描述。</p>
<p>你可以通过传入合适的行和列的数量来构造一个新的 <code>Matrix</code> 实例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> matrix = <span class="type">Matrix</span>(rows: <span class="number">2</span>, columns: <span class="number">2</span>)</div></pre></td></tr></table></figure>
<p>上例中创建了一个新的两行两列的 <code>Matrix</code> 实例。 <code>Matrix</code> 实例中的数组<code>grid</code> 是 矩阵的高效扁平化版本，阅读顺序从左上到右下：<br><img style="margin: auto" src="/2017/11/23/swift-subscript/subscriptMatrix01_2x.png" alt="subscriptMatrix01_2x" title="矩阵图"></p>
<p>矩阵里的值可以通过传行和列给下标来设置，用<strong>逗号分隔</strong>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">matrix[<span class="number">0</span>, <span class="number">1</span>] = <span class="number">1.5</span></div><div class="line">matrix[<span class="number">1</span>, <span class="number">0</span>] = <span class="number">3.2</span></div></pre></td></tr></table></figure>
<p>上面两条语句调用的下标的设置器来给矩阵的右上角（ <code>row</code> 是 0 ， <code>column</code> 是 1 ）赋值为 1.5 ，给左下角（ <code>row</code> 是 1 ， <code>column</code> 是 0 ）赋值为 3.2 ：</p>
<p><img style="margin: auto" src="/2017/11/23/swift-subscript/subscriptMatrix02_2x.png" alt="subscriptMatrix02_2x" title="复制后"></p>
<p><code>Matrix</code> 下标的<strong>设置器和读取器</strong>都包含了一个断言来检查下标的 <code>row</code> 和 <code>column</code> 是否有效。为了方便进行断言， <code>Matrix</code> 包含了一个名为 <code>indexIsValidForRow(_:column:)</code> 的成员方法，它用来确认请求的 <code>row</code> 或 <code>column</code> 值是否会造成数组越界：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">indexIsValidForRow</span><span class="params">(row: Int, column: Int)</span></span> -&gt; <span class="type">Bool</span> &#123;</div><div class="line">    <span class="keyword">return</span> row &gt;= <span class="number">0</span> &amp;&amp; row &lt; rows &amp;&amp; column &gt;= <span class="number">0</span> &amp;&amp; column &lt; columns</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>断言在下标越界时触发:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> someValue = matrix[<span class="number">2</span>, <span class="number">2</span>]</div><div class="line"><span class="comment">// this triggers an assert, because [2, 2] is outside of the matrix bounds</span></div></pre></td></tr></table></figure>
<blockquote>
<p>摘自：<a href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/Swift_Programming_Language/index.html#//apple_ref/doc/uid/TP40014097-CH3-ID0" target="_blank" rel="external">swift 官网</a><br>所有代码在Xcode9 Swift4 环境编译没问题，代码<a href="https://github.com/keshiim/LearnSwift4" target="_blank" rel="external">戳这里 https://github.com/keshiim/LearnSwift4</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://keshiim.github.io/2017/11/23/Leedcode-283-Move-Zeroes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng keshiim">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Farmer, keshiim 播种太阳🌞">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/23/Leedcode-283-Move-Zeroes/" itemprop="url">Leedcode-283 Move Zeroes</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-23T15:26:19+08:00">
                2017-11-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index">
                    <span itemprop="name">LeetCode</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/23/Leedcode-283-Move-Zeroes/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/23/Leedcode-283-Move-Zeroes/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/11/23/Leedcode-283-Move-Zeroes/" class="leancloud_visitors" data-flag-title="Leedcode-283 Move Zeroes">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://leetcode.com/problems/move-zeroes/description/" target="_blank" rel="external">Move Zeroes 移动零</a></p>
<h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>Given an array <code>nums</code>, write a function to move all <code>0</code>s to the end of it while maintaining the relative order of the non-zero elements. For example, given <code>nums = [0, 1, 0, 3, 12]</code>, after calling your function, <code>nums</code> should be <code>[1, 3, 12, 0, 0]</code>.</p>
<h3 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h3><ol>
<li>You must do this <strong>in-place</strong> without making a copy of the array.</li>
<li>Minimize the total number of operations.</li>
</ol>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>这道题让我们将一个给定数组中所有的<code>0</code>都移到后面，把非零数前移，要求不能改变非零数的相对应的位置关系，而且不能拷贝额外数组，只能用替换法<code>in-place</code>来做。</p>
<h3 id="解法一"><a href="#解法一" class="headerlink" title="解法一"></a>解法一</h3><p>两指针，一个不停的向后扫，找到非零位置，然后和前面那个指针交换位置即可，代码如下：</p>
<h4 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">moveZeroes</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; nums.size(); i++) &#123;</div><div class="line">            <span class="keyword">if</span> (nums[i]) &#123;</div><div class="line">                swap(nums[i], nums[j++]);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="Swift"><a href="#Swift" class="headerlink" title="Swift"></a>Swift</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">moveZeroes</span><span class="params">(<span class="number">_</span> nums: <span class="keyword">inout</span> [Int])</span></span> &#123;</div><div class="line">        <span class="keyword">var</span> i = <span class="number">0</span>, j = <span class="number">0</span></div><div class="line">        <span class="keyword">while</span> i &lt; nums.<span class="built_in">count</span> &#123;</div><div class="line">            <span class="keyword">if</span> nums[i] != <span class="number">0</span> &#123;</div><div class="line">                nums.swapAt(i, j)</div><div class="line">                j += <span class="number">1</span></div><div class="line">            &#125;</div><div class="line">            i += <span class="number">1</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="解法二"><a href="#解法二" class="headerlink" title="解法二"></a>解法二</h3><p>方法一的改进，如果扫到的数不是0，并且上面代码中<code>j</code> 和 <code>i</code>数值相同，则不需要交换，代码如下：</p>
<h4 id="C-1"><a href="#C-1" class="headerlink" title="C++"></a>C++</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">moveZeroes</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; nums.size(); i++) &#123;</div><div class="line">            <span class="keyword">if</span> (nums[i]) &#123;</div><div class="line">                <span class="keyword">if</span> (i != j) &#123;</div><div class="line">                    swap(nums[i], nums[j++]);    </div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    j++;   </div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="Swift-1"><a href="#Swift-1" class="headerlink" title="Swift"></a>Swift</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">moveZeros</span><span class="params">(<span class="number">_</span> nums: <span class="keyword">inout</span> [Int])</span></span> &#123;</div><div class="line">    <span class="keyword">var</span> i = <span class="number">0</span>, j = <span class="number">0</span></div><div class="line">    <span class="keyword">while</span> i &lt; nums.<span class="built_in">count</span> &#123;</div><div class="line">        <span class="keyword">if</span> nums[i] != <span class="number">0</span> &#123;</div><div class="line">            <span class="keyword">if</span>  i != j  &#123;</div><div class="line">                nums.swapAt(i, j)</div><div class="line">            &#125;</div><div class="line">            j += <span class="number">1</span></div><div class="line">        &#125;</div><div class="line">        i += <span class="number">1</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">moveZeros(&amp;nums)</div><div class="line"><span class="built_in">print</span>(nums)</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.png"
               alt="Zheng keshiim" />
          <p class="site-author-name" itemprop="name">Zheng keshiim</p>
           
              <p class="site-description motion-element" itemprop="description">一个☝程序猿的播种天地</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">45</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/keshiim" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/Jasonzhengkeshi" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                    
                      Twitter
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/1997859257" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                    
                      Weibo
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/jason-zheng-17/activities" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      知乎
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zheng keshiim</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  

    
      <script id="dsq-count-scr" src="https://keshiim.disqus.com/count.js" async></script>
    

    

  




	





  








  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("II40xJrcdEwAMUcs8t0GQCM7-gzGzoHsz", "6u6FB7dghxObIE4zhaUKCYoF");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
